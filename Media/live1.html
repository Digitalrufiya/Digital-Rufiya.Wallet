<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DRFMedia Live</title>
<style>
  body {
    margin:0;
    font-family: Arial, sans-serif;
    background:#000;
    color:#fff;
    display:flex;
    flex-direction:column;
    align-items:center;
  }
  #live-container {
    width:100%;
    max-width:480px;
    position:relative;
    margin-top:10px;
  }
  video {
    width:100%;
    border-radius:12px;
    background:#000;
  }
  #overlay {
    position:absolute;
    top:10px;
    left:10px;
    display:flex;
    flex-direction:column;
    gap:5px;
    color:#fff;
  }
  #likes, #viewers {
    font-weight:bold;
  }
  #comments {
    max-height:150px;
    overflow-y:auto;
    margin-top:10px;
    font-size:14px;
  }
  #comment-input {
    width:100%;
    display:flex;
    margin-top:10px;
    gap:5px;
  }
  #comment-input input {
    flex:1;
    padding:8px;
    border-radius:8px;
    border:none;
    outline:none;
  }
  #comment-input button {
    padding:8px 12px;
    border:none;
    border-radius:8px;
    background:#ff5722;
    color:#fff;
    font-weight:bold;
    cursor:pointer;
  }
  #go-live {
    margin-top:10px;
    padding:10px 20px;
    border:none;
    border-radius:12px;
    background:#00c853;
    font-size:16px;
    font-weight:bold;
    cursor:pointer;
  }
  .heart {
    position:absolute;
    bottom:0;
    right:20px;
    font-size:24px;
    animation: floatHeart 1.2s forwards;
  }
  @keyframes floatHeart {
    0% {transform:translateY(0); opacity:1;}
    100% {transform:translateY(-120px); opacity:0;}
  }
</style>
</head>
<body>

<h2>üì∫ DRFMedia Live</h2>
<div id="live-container">
  <video id="live-video" autoplay playsinline controls></video>
  <div id="overlay">
    <div id="viewers">üëÅ 0 viewers</div>
    <div id="likes">‚ù§ 0 likes</div>
  </div>
</div>

<div id="comments"></div>

<div id="comment-input">
  <input type="text" id="commentText" placeholder="Say something nice...">
  <button onclick="sendComment()">Send</button>
</div>

<button id="go-live">Go Live</button>

<div id="hearts"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
import { getDatabase, ref, set, push, onValue, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-database.js";

// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyB-W_j74lsbmJUFnTbJpn79HM62VLmkQC8",
  authDomain: "drfsocial-23a06.firebaseapp.com",
  databaseURL: "https://drfsocial-23a06-default-rtdb.firebaseio.com",
  projectId: "drfsocial-23a06",
  storageBucket: "drfsocial-23a06.firebasestorage.app",
  messagingSenderId: "608135115201",
  appId: "1:608135115201:web:dc999df2c0f37241ff3f40",
  measurementId: "G-W6VHMP77YR"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// Livepeer playback URL
const playbackURL = "https://livepeercdn.studio/hls/71f6n2n0h31cgvn1/index.m3u8";
const video = document.getElementById('live-video');
if(Hls.isSupported()){
  const hls = new Hls();
  hls.loadSource(playbackURL);
  hls.attachMedia(video);
} else if(video.canPlayType("application/vnd.apple.mpegurl")){
  video.src = playbackURL;
}

// Firebase refs
const roomId = "drf-live-room";
const viewersRef = ref(db, `rooms/${roomId}/viewers`);
const likesRef = ref(db, `rooms/${roomId}/likes`);
const commentsRef = ref(db, `rooms/${roomId}/comments`);

// Viewer tracking
const viewerId = 'v_' + Math.random().toString(36).slice(2,10);
set(ref(db, `rooms/${roomId}/viewers/${viewerId}`), true);
window.addEventListener('beforeunload', () => {
  set(ref(db, `rooms/${roomId}/viewers/${viewerId}`), null);
});

// Likes
let likeCount = 0;
onValue(likesRef, snap => {
  likeCount = snap.val() || 0;
  document.getElementById('likes').textContent = `‚ù§ ${likeCount} likes`;
});

// Comments
const commentsDiv = document.getElementById('comments');
onValue(commentsRef, snap => {
  commentsDiv.innerHTML = '';
  const val = snap.val() || {};
  Object.values(val).forEach(c => {
    const div = document.createElement('div');
    div.textContent = `${c.name}: ${c.text}`;
    commentsDiv.appendChild(div);
  });
  commentsDiv.scrollTop = commentsDiv.scrollHeight;
});

// Viewer count
onValue(viewersRef, snap => {
  const val = snap.val() || {};
  document.getElementById('viewers').textContent = `üëÅ ${Object.keys(val).length} viewers`;
});

// Send comment
function sendComment(){
  const text = document.getElementById('commentText').value.trim();
  if(!text) return;
  const cRef = push(commentsRef);
  set(cRef, { name: "User", text, ts: Date.now() });
  document.getElementById('commentText').value = '';
}

// Heart animation on like
document.getElementById('likes').addEventListener('click', () => {
  const heart = document.createElement('div');
  heart.className = 'heart';
  heart.textContent = '‚ù§Ô∏è';
  document.body.appendChild(heart);
  setTimeout(()=>heart.remove(), 1200);
  // Increment likes in Firebase
  set(likesRef, likeCount + 1);
});

// Go live button
document.getElementById('go-live').addEventListener('click', () => {
  alert("To go live: Use OBS or a mobile streaming app.\nStream to your Livepeer RTMP key.\nOnce streaming, it will appear here automatically!");
});

</script>
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
</body>
</html>
