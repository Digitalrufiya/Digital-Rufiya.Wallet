<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Go Live with Player</title>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
      background: #111;
      color: white;
    }
    video {
      width: 80%;
      max-width: 800px;
      margin: 10px 0;
      background: black;
      border: 2px solid #00ff88;
      border-radius: 12px;
    }
    button {
      padding: 10px 20px;
      margin: 10px;
      border: none;
      border-radius: 8px;
      background: #00ff88;
      color: black;
      font-weight: bold;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>üì° DRF Live Stream</h1>

  <!-- Local preview -->
  <video id="localVideo" autoplay muted playsinline></video>
  <button id="startBtn">Go Live</button>

  <!-- Playback -->
  <h2>üé• Live Playback</h2>
  <video id="playback" controls autoplay></video>

  <script>
    const startBtn = document.getElementById("startBtn");
    const localVideo = document.getElementById("localVideo");
    const playback = document.getElementById("playback");

    const PLAYBACK_URL = "https://livepeercdn.studio/hls/71f6n2n0h31cgvn1/index.m3u8";
    const STREAM_KEY = "71f6-vu4y-y16x-3e3p";
    const LIVEPEER_API_KEY = "86690d89-ff4d-4e5e-abeb-68c2d7582b35";

    // Show playback
    if (Hls.isSupported()) {
      const hls = new Hls();
      hls.loadSource(PLAYBACK_URL);
      hls.attachMedia(playback);
    } else if (playback.canPlayType("application/vnd.apple.mpegurl")) {
      playback.src = PLAYBACK_URL;
    }

    // Start local preview & push to Livepeer
    startBtn.onclick = async () => {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
        localVideo.srcObject = stream;

        // Push stream to Livepeer via WebRTC
        const pc = new RTCPeerConnection();
        stream.getTracks().forEach(track => pc.addTrack(track, stream));

        const offer = await pc.createOffer();
        await pc.setLocalDescription(offer);

        const res = await fetch("https://livepeer.studio/webrtc/ingest", {
          method: "POST",
          headers: {
            "Authorization": "Bearer " + LIVEPEER_API_KEY,
            "Content-Type": "application/sdp"
          },
          body: offer.sdp
        });

        const answer = {
          type: "answer",
          sdp: await res.text()
        };
        await pc.setRemoteDescription(answer);

        alert("‚úÖ You are LIVE now!");
      } catch (err) {
        alert("‚ùå Error: " + err.message);
      }
    };
  </script>
</body>
</html>
