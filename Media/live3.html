<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>DRFChain Media - Go Live</title>
</head>
<body style="font-family: Arial, sans-serif; text-align: center; padding: 40px;">
  <h2>🎥 DRFChain Media - Test Live Stream</h2>
  <video id="preview" autoplay muted playsinline style="width: 80%; border:1px solid #ccc; border-radius:8px;"></video>
  <br><br>
  <button id="goLiveBtn" style="padding: 12px 24px; font-size:16px; cursor:pointer;">🚀 Go Live</button>
  <p id="status"></p>

  <script src="https://unpkg.com/@livepeer/webrtmp-sdk"></script>
  <script>
    const goLiveBtn = document.getElementById("goLiveBtn");
    const videoEl = document.getElementById("preview");
    const statusEl = document.getElementById("status");

    // ⚠️ Replace with your REAL signed token from backend
    // This one is just placeholder - won’t work forever
    const JWT_TOKEN = "PASTE_YOUR_SIGNED_JWT_HERE";

    // Replace with your Livepeer Stream Key
    const STREAM_KEY = "71f6-vu4y-y16x-3e3p";

    goLiveBtn.onclick = async () => {
      try {
        statusEl.innerText = "Requesting camera...";
        const mediaStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
        videoEl.srcObject = mediaStream;

        statusEl.innerText = "Connecting to Livepeer...";

        const client = new Livepeer.WebRTMP.Client({ token: JWT_TOKEN });
        const session = client.cast(mediaStream, { streamKey: STREAM_KEY });

        await session.start();
        statusEl.innerText = "✅ Live stream started!";
      } catch (err) {
        console.error("❌ Failed to Start live Stream", err);
        statusEl.innerText = "❌ Failed to Start live Stream. Check console.";
      }
    };
  </script>
</body>
</html>
