<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DRFMedia Social Login</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    #authBtn { padding: 10px 20px; font-size: 16px; cursor: pointer; }
  </style>
</head>
<body>

<h1>Welcome to DRFMedia</h1>
<p id="status">Checking login status...</p>
<button id="authBtn" disabled>Loading...</button>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
  import {
    getAuth,
    signInWithPopup,
    GoogleAuthProvider,
    signOut,
    onAuthStateChanged
  } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-auth.js";

  // Your Firebase config - replace with yours
  const firebaseConfig = {
    apiKey: "AIzaSyB-W_j74lsbmJUFnTbJpn79HM62VLmkQC8",
    authDomain: "drfsocial-23a06.firebaseapp.com",
    projectId: "drfsocial-23a06",
    storageBucket: "drfsocial-23a06.appspot.com",
    messagingSenderId: "608135115201",
    appId: "1:608135115201:web:dc999df2c0f37241ff3f40"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const provider = new GoogleAuthProvider();

  const authBtn = document.getElementById("authBtn");
  const status = document.getElementById("status");

  // Check wallet login from localStorage
  function walletLoggedIn() {
    return !!localStorage.getItem("drf_active_wallet");
  }

  function updateUI(user) {
    if (user && walletLoggedIn()) {
      authBtn.textContent = "Logout";
      status.textContent = `Logged in as ${user.displayName} (${localStorage.getItem("drf_active_wallet").slice(0,6)}...${localStorage.getItem("drf_active_wallet").slice(-4)})`;
    } else if (!walletLoggedIn()) {
      authBtn.textContent = "Please login wallet first";
      status.textContent = "You must login to your DRF Wallet first!";
      authBtn.disabled = true;
    } else {
      authBtn.textContent = "Login with Google";
      status.textContent = "Not logged in to Google";
      authBtn.disabled = false;
    }
  }

  onAuthStateChanged(auth, (user) => {
    updateUI(user);
  });

  authBtn.addEventListener("click", async () => {
    if (!walletLoggedIn()) {
      alert("Please login to your DRF Wallet first.");
      return;
    }

    if (auth.currentUser) {
      // Logout Google
      await signOut(auth);
      alert("Logged out from Google");
    } else {
      try {
        await signInWithPopup(auth, provider);
        alert("Google login successful!");
      } catch (error) {
        alert("Google login failed: " + error.message);
      }
    }
  });

  // Initialize UI
  updateUI(auth.currentUser);
</script>

</body>
</html>
