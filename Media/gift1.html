<!-- DRFMedia - Video Only Timeline -->
<!-- Posting form and image posts removed. Only video posts are displayed. -->
<!-- Retains full design, likes, comments, boosts, search, login, donate, etc. -->

<!-- Full updated HTML file below -->
<!-- START OF FILE -->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DRFMedia Timeline ‚Äî Video Only</title>
  <!-- Keep all original CSS as-is -->
  <style>
    /* Keep all your original CSS unchanged */
  </style>
</head>
<body>

<header>
  <!-- Header unchanged -->
</header>

<div id="searchBar">
  <input type="text" id="searchInput" placeholder="Search videos..." />
</div>

<!-- Removed uploadForm entirely -->

<main id="postContainer" aria-live="polite"></main>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-app.js";
  import {
    getDatabase, ref, push, set, onValue, get, runTransaction
  } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-database.js";
  import {
    getAuth, signInWithPopup, signOut, GoogleAuthProvider, onAuthStateChanged
  } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-auth.js";

  const firebaseConfig = { /* Your config as-is */ };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const auth = getAuth(app);
  const provider = new GoogleAuthProvider();

  const loginBtn = document.getElementById("loginBtn");
  const logoutBtn = document.getElementById("logoutBtn");
  const postContainer = document.getElementById("postContainer");
  const searchInput = document.getElementById("searchInput");
  let currentUser = null;
  let allPosts = [];

  onAuthStateChanged(auth, (user) => {
    currentUser = user;
    loginBtn.style.display = user ? "none" : "inline-block";
    logoutBtn.style.display = user ? "inline-block" : "none";
    renderPosts();
  });

  loginBtn.onclick = () => signInWithPopup(auth, provider).catch((e) => alert("Login failed: " + e.message));
  logoutBtn.onclick = () => signOut(auth).catch((e) => alert("Logout failed: " + e.message));

  const postsRef = ref(db, "posts");
  onValue(postsRef, (snapshot) => {
    const posts = snapshot.val() || {};
    allPosts = Object.entries(posts).map(([id, post]) => ({ id, ...post }));
    allPosts.sort((a, b) => b.timestamp - a.timestamp);
    renderPosts();
  });

  function escapeHTML(str) {
    return String(str).replace(/[&<>\"]/g, (c) => ({ "&": "&amp;", "<": "&lt;", ">": "&gt;", '"': "&quot;" }[c]));
  }

  function renderPosts() {
    const filter = searchInput.value.trim().toLowerCase();
    postContainer.innerHTML = "";
    for (const post of allPosts) {
      if (!post.caption.toLowerCase().includes(filter)) continue;
      if (post.mediaType !== "video") continue; // Only show videos

      const url = "https://gateway.pinata.cloud/ipfs/" + post.ipfsHash;
      const isBoosted = currentUser && post.boostedBy && post.boostedBy[currentUser.uid];
      const isLiked = currentUser && post.likesBy && post.likesBy[currentUser.uid];
      const dateStr = new Date(post.timestamp).toLocaleString();

      const card = document.createElement("article");
      card.className = "post-item";
      card.innerHTML = `
        <header class="post-owner">
          <img src="${post.photoURL || 'https://via.placeholder.com/40'}" class="avatar" alt="${escapeHTML(post.displayName)} avatar">
          <div>
            <div>${escapeHTML(post.displayName || "Anonymous")}</div>
            <time class="post-time">${dateStr}</time>
          </div>
        </header>
        <div class="post-caption">${escapeHTML(post.caption)}</div>
        <div class="post-media">
          <video src="${url}" controls preload="metadata" playsinline></video>
        </div>
        <div class="post-actions">
          <button class="${isLiked ? 'liked' : ''}" onclick="likePost('${post.id}')">${isLiked ? "üëç Liked" : "üëç Like"} (${post.likesCount || 0})</button>
          <button onclick="commentOnPost('${post.id}')">üí¨ Comment (${post.commentsCount || 0})</button>
          <button class="${isBoosted ? 'boosted' : ''}" onclick="boostPost('${post.id}')">${isBoosted ? "üöÄ Boosted" : "üöÄ Boost"} (${post.boostsCount || 0})</button>
          <select onchange="donateToPost('${post.id}', '${post.userId}', this.value)">
            <option value="">Donate üíñ</option>
            <option value="1">$1</option>
            <option value="10">$10</option>
            <option value="20">$20</option>
          </select>
        </div>
        <div class="comments-container" id="comments-${post.id}"></div>
        ${currentUser ? `
        <form class="comment-form" onsubmit="return submitComment(event, '${post.id}')">
          <input type="text" id="comment-input-${post.id}" placeholder="Write a comment..." required />
          <button type="submit">Post</button>
        </form>` : ""}
      `;
      postContainer.appendChild(card);
      loadComments(post.id);
    }
  }

  searchInput.addEventListener("input", renderPosts);

  window.likePost = async function (postId) {
    if (!currentUser) return alert("Login first");
    const likeRef = ref(db, `posts/${postId}/likesBy/${currentUser.uid}`);
    const countRef = ref(db, `posts/${postId}/likesCount`);
    const snap = await get(likeRef);
    if (snap.exists()) {
      await set(likeRef, null);
      await runTransaction(countRef, c => (c || 1) - 1);
    } else {
      await set(likeRef, true);
      await runTransaction(countRef, c => (c || 0) + 1);
    }
  };

  window.boostPost = async function (postId) {
    if (!currentUser) return alert("Login first");
    const boostRef = ref(db, `posts/${postId}/boostedBy/${currentUser.uid}`);
    const countRef = ref(db, `posts/${postId}/boostsCount`);
    const snap = await get(boostRef);
    if (snap.exists()) {
      await set(boostRef, null);
      await runTransaction(countRef, c => (c || 1) - 1);
    } else {
      await set(boostRef, true);
      await runTransaction(countRef, c => (c || 0) + 1);
    }
  };

  window.commentOnPost = function (postId) {
    const input = document.getElementById("comment-input-" + postId);
    if (input) input.focus();
  };

  window.submitComment = async function (e, postId) {
    e.preventDefault();
    const input = document.getElementById("comment-input-" + postId);
    const comment = input.value.trim();
    if (!comment) return;

    const newRef = push(ref(db, `comments/${postId}`));
    await set(newRef, {
      userId: currentUser.uid,
      name: currentUser.displayName || "User",
      photo: currentUser.photoURL || "",
      text: comment,
      timestamp: Date.now(),
    });
    input.value = "";
  };

  function loadComments(postId) {
    const container = document.getElementById("comments-" + postId);
    const refPath = ref(db, `comments/${postId}`);
    onValue(refPath, (snapshot) => {
      const comments = snapshot.val() || {};
      const entries = Object.values(comments).sort((a, b) => a.timestamp - b.timestamp);
      container.innerHTML = entries.map(c => `
        <div class="comment">
          <img src="${c.photo || 'https://via.placeholder.com/28'}" class="avatar" />
          <div class="comment-body"><strong>${escapeHTML(c.name)}</strong><br>${escapeHTML(c.text)}</div>
        </div>`).join("");
    });
  }

  window.donateToPost = function (postId, userId, amount) {
    if (!currentUser) return alert("Login to donate");
    if (!amount) return;
    const skrillEmail = "digitalrufiyacoin@gmail.com";
    alert(`Send $${amount} to: ${skrillEmail} via Skrill\nThank you!`);
    document.querySelectorAll("select").forEach(sel => sel.value = "");
  };
</script>

</body>
</html>

<!-- END OF FILE -->
