<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>DRFChain Boost Post</title>
<script src="https://cdn.ethers.io/lib/ethers-5.6.umd.min.js" type="application/javascript"></script>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  label, input, button { display: block; margin-top: 10px; }
  input, button { padding: 8px; font-size: 16px; }
  #status { margin-top: 15px; font-weight: bold; }
</style>
</head>
<body>

<h2>Boost a Post (Promote your Business)</h2>

<button id="connectBtn">Connect Wallet</button>
<div id="account"></div>

<div id="boostForm" style="display:none;">
  <label>Your DRFM Balance: <span id="balance">0</span> DRFM</label>
  
  <label for="postId">Post ID to Boost:</label>
  <input type="number" id="postId" min="0" placeholder="Enter Post ID" required />
  
  <label for="amount">Boost Amount (DRFM tokens):</label>
  <input type="number" id="amount" min="1" placeholder="Enter amount to pay" required />
  
  <button id="boostBtn">Boost Now</button>
  
  <div id="status"></div>
</div>

<script>
  const contractAddress = "0xYourContractAddressHere";  // <-- Replace with your contract address
  const contractABI = [
    // Minimal ABI for ERC20 balanceOf and transfer
    "function balanceOf(address) view returns (uint256)",
    "function transfer(address to, uint amount) returns (bool)",
    "function owner() view returns (address)"
  ];

  let provider, signer, contract, userAddress, ownerAddress;

  const connectBtn = document.getElementById('connectBtn');
  const accountDiv = document.getElementById('account');
  const boostForm = document.getElementById('boostForm');
  const balanceSpan = document.getElementById('balance');
  const postIdInput = document.getElementById('postId');
  const amountInput = document.getElementById('amount');
  const boostBtn = document.getElementById('boostBtn');
  const statusDiv = document.getElementById('status');

  connectBtn.onclick = async () => {
    if (!window.ethereum) {
      alert("MetaMask or compatible wallet required");
      return;
    }

    try {
      provider = new ethers.providers.Web3Provider(window.ethereum);
      await provider.send("eth_requestAccounts", []);
      signer = provider.getSigner();
      userAddress = await signer.getAddress();

      contract = new ethers.Contract(contractAddress, contractABI, signer);
      ownerAddress = await contract.owner();

      accountDiv.textContent = `Connected: ${userAddress}`;
      connectBtn.style.display = 'none';
      boostForm.style.display = 'block';

      updateBalance();
    } catch (err) {
      alert("Connection error: " + err.message);
    }
  };

  async function updateBalance() {
    try {
      let bal = await contract.balanceOf(userAddress);
      // Convert from BigNumber with 18 decimals
      balanceSpan.textContent = ethers.utils.formatUnits(bal, 18);
    } catch (err) {
      balanceSpan.textContent = "Error";
    }
  }

  boostBtn.onclick = async () => {
    const postId = parseInt(postIdInput.value);
    const amountStr = amountInput.value;

    if (isNaN(postId) || postId < 0) {
      alert("Please enter a valid post ID");
      return;
    }

    if (!amountStr || isNaN(amountStr) || Number(amountStr) <= 0) {
      alert("Please enter a valid amount");
      return;
    }

    const amount = ethers.utils.parseUnits(amountStr, 18);

    try {
      const userBal = await contract.balanceOf(userAddress);
      if (userBal.lt(amount)) {
        alert("Insufficient DRFM balance to boost");
        return;
      }

      statusDiv.textContent = "Sending tokens to owner wallet to boost...";
      boostBtn.disabled = true;

      // Send tokens to owner address as boost payment
      const tx = await contract.transfer(ownerAddress, amount);
      await tx.wait();

      statusDiv.textContent = `Successfully boosted post #${postId} with ${amountStr} DRFM tokens! Thank you for your support.`;
      
      // Optionally reset form
      postIdInput.value = "";
      amountInput.value = "";
      updateBalance();
    } catch (err) {
      statusDiv.textContent = "Transaction failed: " + (err.data?.message || err.message || err);
    } finally {
      boostBtn.disabled = false;
    }
  };
</script>

</body>
</html>
