<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>DRFMedia Posts Test</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; background: #fafafa; }
  .post-item { border: 1px solid #ccc; border-radius: 6px; padding: 15px; margin-bottom: 20px; background: white; max-width: 700px; }
  .post-owner { display: flex; align-items: center; gap: 10px; font-weight: 700; }
  .post-owner img.avatar { width: 32px; height: 32px; border-radius: 50%; object-fit: cover; border: 1px solid #ccc; }
  .post-time { font-size: 0.85em; color: #555; margin-top: 4px; }
  .post-caption { margin-top: 10px; white-space: pre-wrap; }
  video, img { max-width: 100%; border-radius: 6px; margin-top: 10px; background: black; display: block; }
</style>
</head>
<body>

<h2>DRFMedia Posts (Test View, No Login Required)</h2>
<div id="postContainer">Loading posts...</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-app.js";
import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyB-W_j74lsbmJUFnTbJpn79HM62VLmkQC8",
  authDomain: "drfsocial-23a06.firebaseapp.com",
  databaseURL: "https://drfsocial-23a06-default-rtdb.firebaseio.com",
  projectId: "drfsocial-23a06",
  storageBucket: "drfsocial-23a06.appspot.com",
  messagingSenderId: "608135115201",
  appId: "1:608135115201:web:dc999df2c0c37241ff3f40"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const postContainer = document.getElementById("postContainer");

function escapeHTML(str) {
  return str.replace(/[&<>"]/g, c => ({ "&": "&amp;", "<": "&lt;", ">": "&gt;", '"': "&quot;" }[c]));
}

function renderPosts() {
  onValue(ref(db, "posts"), snap => {
    postContainer.innerHTML = "";
    const data = snap.val();
    if (!data) {
      postContainer.innerHTML = "<p>No posts yet.</p>";
      return;
    }

    Object.entries(data)
      .sort((a, b) => b[1].timestamp - a[1].timestamp)
      .forEach(([postId, post]) => {
        const card = document.createElement("div");
        card.className = "post-item";

        const safeName = escapeHTML(post.displayName || "Anonymous");
        const safeCaption = escapeHTML(post.caption);

        let mediaHTML = "";
        if (post.mediaType === "video") {
          const mimeType = post.mediaMimeType || "video/mp4";
          mediaHTML = `<video controls preload="metadata" width="100%">
            <source src="${post.mediaUrl}" type="${mimeType}" />
            Your browser does not support the video tag.
          </video>`;
        } else {
          mediaHTML = `<img src="${post.mediaUrl}" alt="User uploaded image" />`;
        }

        card.innerHTML = `
          <div class="post-owner">
            <img src="${post.photoURL || ''}" class="avatar" alt="User avatar" />
            <strong>${safeName}</strong>
          </div>
          <div class="post-time">${new Date(post.timestamp).toLocaleString()}</div>
          ${mediaHTML}
          <div class="post-caption">${safeCaption}</div>
        `;
        postContainer.appendChild(card);
      });
  });
}

renderPosts();
</script>

</body>
</html>
