<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DRFMedia Live</title>
  <style>
    body { margin: 0; font-family: Arial, sans-serif; background: #000; color: #fff; overflow: hidden; }
    #live-container { position: relative; width: 100%; height: 100vh; display: flex; justify-content: center; align-items: center; }
    video { width: 100%; height: 100%; object-fit: cover; }
    #overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
    #chat { position: absolute; bottom: 20px; left: 10px; max-height: 50%; overflow-y: auto; width: 40%; }
    .chat-message { margin-bottom: 5px; }
    #controls { position: absolute; bottom: 20px; right: 20px; pointer-events: auto; display: flex; flex-direction: column; gap: 10px; }
    button { padding: 10px 20px; border: none; border-radius: 10px; font-size: 16px; cursor: pointer; }
    #hearts { position: absolute; bottom: 0; right: 20px; pointer-events: none; }
    .heart { position: absolute; font-size: 24px; animation: floatUp 1s linear forwards; }
    @keyframes floatUp { 0% { transform: translateY(0); opacity: 1; } 100% { transform: translateY(-150px); opacity: 0; } }
    #viewerCount { position: absolute; top: 20px; left: 20px; font-size: 18px; background: rgba(0,0,0,0.5); padding: 5px 10px; border-radius: 8px; }
    #liveBadge { position: absolute; top: 20px; right: 20px; font-size: 18px; background: red; padding: 5px 10px; border-radius: 8px; }
  </style>
</head>
<body>

<div id="live-container">
  <video id="live-video" autoplay playsinline></video>
  <div id="overlay">
    <div id="viewerCount">üëÅ 0</div>
    <div id="liveBadge">LIVE</div>
    <div id="chat"></div>
    <div id="hearts"></div>
    <div id="controls">
      <button id="btnGoLive">Go Live</button>
      <button id="btnLike">‚ù§Ô∏è Like</button>
      <input id="commentInput" placeholder="Say something nice‚Ä¶" style="padding:8px;border-radius:10px;border:none;width:200px;">
      <button id="btnComment">Send</button>
    </div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
import { getDatabase, ref, push, onValue, set, remove, onDisconnect } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-database.js";

// Your Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyB-W_j74lsbmJUFnTbJpn79HM62VLmkQC8",
  authDomain: "drfsocial-23a06.firebaseapp.com",
  databaseURL: "https://drfsocial-23a06-default-rtdb.firebaseio.com",
  projectId: "drfsocial-23a06",
  storageBucket: "drfsocial-23a06.firebasestorage.app",
  messagingSenderId: "608135115201",
  appId: "1:608135115201:web:dc999df2c0f37241ff3f40",
  measurementId: "G-W6VHMP77YR"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// Livepeer playback URL
const LIVEPLAYBACK_URL = "https://livepeercdn.studio/hls/71f6n2n0h31cgvn1/index.m3u8";

const video = document.getElementById('live-video');
const btnGoLive = document.getElementById('btnGoLive');
const btnLike = document.getElementById('btnLike');
const btnComment = document.getElementById('btnComment');
const commentInput = document.getElementById('commentInput');
const chat = document.getElementById('chat');
const hearts = document.getElementById('hearts');
const viewerCountDiv = document.getElementById('viewerCount');

let userId = 'user_' + Math.random().toString(36).substring(2,10);
let streamId = 'main_stream';

// Load HLS video for viewers
if(Hls.isSupported()){
  const hlsScript = document.createElement('script');
  hlsScript.src = "https://cdn.jsdelivr.net/npm/hls.js@latest";
  hlsScript.onload = () => {
    const hls = new Hls();
    hls.loadSource(LIVEPLAYBACK_URL);
    hls.attachMedia(video);
  };
  document.body.appendChild(hlsScript);
} else {
  video.src = LIVEPLAYBACK_URL;
}

// Realtime viewers count
const viewersRef = ref(db, `live/${streamId}/viewers`);
const meRef = push(viewersRef);
set(meRef, true);
onDisconnect(meRef).remove();
onValue(viewersRef, snap => {
  const val = snap.val() || {};
  viewerCountDiv.textContent = `üëÅ ${Object.keys(val).length}`;
});

// Likes system
const likesRef = ref(db, `live/${streamId}/likes`);
btnLike.addEventListener('click', async () => {
  const myLikeRef = ref(db, `live/${streamId}/likes/${userId}`);
  await set(myLikeRef, true);
  spawnHeart();
});
onValue(likesRef, snap => {
  // Optionally display total likes somewhere
});

// Comments system
const commentsRef = ref(db, `live/${streamId}/comments`);
btnComment.addEventListener('click', async () => {
  const text = commentInput.value.trim();
  if(!text) return;
  const commentRef = push(commentsRef);
  await set(commentRef, { userId, text, ts: Date.now() });
  commentInput.value = '';
});
onValue(commentsRef, snap => {
  chat.innerHTML = '';
  const val = snap.val() || {};
  Object.values(val).forEach(c => {
    const div = document.createElement('div');
    div.className = 'chat-message';
    div.textContent = `${c.userId}: ${c.text}`;
    chat.appendChild(div);
    chat.scrollTop = chat.scrollHeight;
  });
});

// Floating hearts
function spawnHeart(){
  const h = document.createElement('div');
  h.className = 'heart';
  h.textContent = '‚ù§Ô∏è';
  h.style.right = Math.random()*50 + 'px';
  hearts.appendChild(h);
  setTimeout(()=>hearts.removeChild(h), 1000);
}

// Go Live (Host mode)
btnGoLive.addEventListener('click', async () => {
  const stream = await navigator.mediaDevices.getUserMedia({video:true, audio:true});
  video.srcObject = stream;
  video.play();
  alert("You are live! Stream via OBS or WHIP to Livepeer using your stream key for broadcasting to viewers.");
});

</script>
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
</body>
</html>
