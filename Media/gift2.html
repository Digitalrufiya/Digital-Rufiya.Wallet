<!DOCTYPE html>
<html lang="en">
<head>
Â  <meta charset="UTF-8" />
Â  <meta name="viewport" content="width=device-width, initial-scale=1" />
Â  <title>DRFMedia Timeline â€” Spread Kindness & Truth</title>
Â  <!-- ğŸ”¹ Serviceâ€‘worker registration (added) -->
Â  <script>
Â  Â  if ("serviceWorker" in navigator) {
Â  Â  Â  navigator.serviceWorker.register("/sw.js")
Â  Â  Â  Â  .then(() => console.log("SW registered âœ…"))
Â  Â  Â  Â  .catch(err => console.error("SW registration failed âŒ", err));
Â  Â  }
Â  </script>
Â  <link rel="stylesheet" href="style.css" />
Â  <style>
Â  Â  body { font-family: Arial, sans-serif; margin: 0; background: #fff; color: #222; }
Â  Â  header {
Â  Â  Â  background: #007bff; color: white; padding: 10px 20px;
Â  Â  Â  position: sticky; top: 0; z-index: 1000;
Â  Â  Â  box-shadow: 0 2px 4px rgb(0 0 0 / 0.1);
Â  Â  Â  display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap;
Â  Â  }
Â  Â  .navbar-left { display: flex; align-items: center; gap: 10px; }
Â  Â  .navbar-left img { height: 40px; width: 40px; border-radius: 4px; background: white; padding: 2px; }
Â  Â  .navbar-left h1 { margin: 0; font-size: 1.4em; font-weight: 700; }

    /* ======= MENU STYLES ======= */
    nav.menu {
      background: #007bff;
      padding: 8px 20px;
      display: flex;
      gap: 20px;
      justify-content: center;
      flex-wrap: wrap;
      position: sticky;
      top: 48px; /* below header */
      z-index: 999;
    }
    nav.menu a {
      color: white;
      text-decoration: none;
      font-weight: 600;
      padding: 8px 12px;
      border-radius: 6px;
      transition: background-color 0.3s;
      user-select: none;
    }
    nav.menu a:hover, nav.menu a.active {
      background: #0056b3;
    }

Â  Â  video, img {
Â  Â  Â  max-width: 100%;
Â  Â  Â  border-radius: 6px;
Â  Â  Â  margin-top: 10px;
Â  Â  Â  background: black;
Â  Â  Â  display: block;
Â  Â  }
Â  Â  .post-media video { width: 100%; border-radius: 6px; }
Â  Â  .post-item {
Â  Â  Â  border: 1px solid #ddd;
Â  Â  Â  border-radius: 8px;
Â  Â  Â  margin: 16px 20px;
Â  Â  Â  padding: 14px 18px;
Â  Â  Â  box-shadow: 0 1px 6px rgba(0,0,0,0.1);
Â  Â  }
Â  Â  .post-owner {
Â  Â  Â  display: flex;
Â  Â  Â  align-items: center;
Â  Â  Â  gap: 12px;
Â  Â  Â  font-weight: 600;
Â  Â  }
Â  Â  .post-owner img.avatar {
Â  Â  Â  width: 40px;
Â  Â  Â  height: 40px;
Â  Â  Â  border-radius: 50%;
Â  Â  Â  background: #eee;
Â  Â  }
Â  Â  .post-caption {
Â  Â  Â  margin: 12px 0;
Â  Â  Â  font-size: 1.1rem;
Â  Â  }
Â  Â  .post-actions {
Â  Â  Â  display: flex;
Â  Â  Â  gap: 8px;
Â  Â  Â  flex-wrap: wrap;
Â  Â  Â  margin-top: 8px;
Â  Â  }
Â  Â  .post-actions button, .post-actions select {
Â  Â  Â  cursor: pointer;
Â  Â  Â  border: none;
Â  Â  Â  background: #007bff;
Â  Â  Â  color: white;
Â  Â  Â  padding: 8px 14px;
Â  Â  Â  border-radius: 6px;
Â  Â  Â  font-weight: 600;
Â  Â  Â  font-size: 1rem;
Â  Â  Â  user-select: none;
Â  Â  Â  transition: background-color 0.3s ease;
Â  Â  }
Â  Â  .post-actions button:hover, .post-actions select:hover {
Â  Â  Â  background: #0056b3;
Â  Â  }
Â  Â  .post-actions button.liked {
Â  Â  Â  background: #28a745 !important;
Â  Â  Â  box-shadow: 0 0 8px #28a745aa;
Â  Â  }
Â  Â  .post-actions button.boosted {
Â  Â  Â  background: gold !important;
Â  Â  Â  color: #000 !important;
Â  Â  Â  box-shadow: 0 0 8px #ffd700cc;
Â  Â  }
Â  Â  .comments-container {
Â  Â  Â  margin-top: 10px;
Â  Â  Â  max-height: 160px;
Â  Â  Â  overflow-y: auto;
Â  Â  Â  border-top: 1px solid #ccc;
Â  Â  Â  padding-top: 8px;
Â  Â  }
Â  Â  .comment {
Â  Â  Â  display: flex;
Â  Â  Â  align-items: flex-start;
Â  Â  Â  gap: 8px;
Â  Â  Â  margin-bottom: 8px;
Â  Â  Â  font-size: 0.9rem;
Â  Â  }
Â  Â  .comment img.avatar {
Â  Â  Â  width: 30px;
Â  Â  Â  height: 30px;
Â  Â  Â  border-radius: 50%;
Â  Â  Â  background: #eee;
Â  Â  }
Â  Â  .comment-body {
Â  Â  Â  background: #f5f5f5;
Â  Â  Â  padding: 6px 12px;
Â  Â  Â  border-radius: 8px;
Â  Â  Â  flex: 1;
Â  Â  Â  word-break: break-word;
Â  Â  }
Â  Â  .comment-body strong {
Â  Â  Â  display: block;
Â  Â  Â  color: #007bff;
Â  Â  Â  margin-bottom: 4px;
Â  Â  }
Â  Â  .comment-form {
Â  Â  Â  margin-top: 10px;
Â  Â  Â  display: flex;
Â  Â  Â  gap: 8px;
Â  Â  }
Â  Â  .comment-form input {
Â  Â  Â  flex: 1;
Â  Â  Â  padding: 8px 12px;
Â  Â  Â  border-radius: 6px;
Â  Â  Â  border: 1.5px solid #ccc;
Â  Â  Â  font-size: 1rem;
Â  Â  Â  font-family: inherit;
Â  Â  Â  outline-offset: 2px;
Â  Â  Â  transition: border-color 0.3s;
Â  Â  }
Â  Â  .comment-form input:focus {
Â  Â  Â  border-color: #007bff;
Â  Â  Â  outline: none;
Â  Â  }
Â  Â  .comment-form button {
Â  Â  Â  background: #007bff;
Â  Â  Â  color: white;
Â  Â  Â  border: none;
Â  Â  Â  padding: 8px 14px;
Â  Â  Â  border-radius: 6px;
Â  Â  Â  font-weight: 600;
Â  Â  Â  cursor: pointer;
Â  Â  Â  user-select: none;
Â  Â  Â  transition: background-color 0.3s;
Â  Â  }
Â  Â  .comment-form button:hover {
Â  Â  Â  background: #0056b3;
Â  Â  }
Â  Â  /* Skrill Donation Modal */
Â  Â  #skrillModal {
Â  Â  Â  position: fixed;
Â  Â  Â  top: 0; left: 0; right: 0; bottom: 0;
Â  Â  Â  background: rgba(0,0,0,0.5);
Â  Â  Â  display: none;
Â  Â  Â  justify-content: center;
Â  Â  Â  align-items: center;
Â  Â  Â  z-index: 2000;
Â  Â  }
Â  Â  #skrillModalContent {
Â  Â  Â  background: white;
Â  Â  Â  border-radius: 12px;
Â  Â  Â  padding: 20px 28px;
Â  Â  Â  max-width: 320px;
Â  Â  Â  box-shadow: 0 4px 15px rgba(0,0,0,0.25);
Â  Â  Â  text-align: center;
Â  Â  Â  font-family: Arial, sans-serif;
Â  Â  }
Â  Â  #skrillModalContent h2 {
Â  Â  Â  margin-top: 0;
Â  Â  Â  color: #007bff;
Â  Â  }
Â  Â  #skrillModalContent p {
Â  Â  Â  margin: 10px 0;
Â  Â  Â  font-size: 1.1rem;
Â  Â  }
Â  Â  #skrillQRCode {
Â  Â  Â  width: 180px;
Â  Â  Â  height: 180px;
Â  Â  Â  margin: 12px auto;
Â  Â  Â  border-radius: 12px;
Â  Â  Â  border: 2px solid #007bff;
Â  Â  Â  object-fit: contain;
Â  Â  }
Â  Â  #skrillModalContent button {
Â  Â  Â  margin-top: 14px;
Â  Â  Â  background: #007bff;
Â  Â  Â  color: white;
Â  Â  Â  border: none;
Â  Â  Â  padding: 10px 18px;
Â  Â  Â  border-radius: 8px;
Â  Â  Â  font-weight: 600;
Â  Â  Â  cursor: pointer;
Â  Â  Â  user-select: none;
Â  Â  Â  transition: background-color 0.3s;
Â  Â  }
Â  Â  #skrillModalContent button:hover {
Â  Â  Â  background: #0056b3;
Â  Â  }
Â  </style>
</head>
<body>

Â  <!-- ===== MENU ADDED ===== -->
Â  <nav class="menu" role="navigation" aria-label="Primary navigation">
Â  Â  <a href="media.html" class="active">Timeline</a>
Â  Â  <a href="profile.html">Profile</a>
Â  Â  <a href="media.html">Posts</a>
Â  Â  <a href="gift.html">Donation</a>
Â  Â  <a href="chat.html">Chat</a>
Â  </nav>

Â  <header>
Â  Â  <div class="navbar-left">
Â  Â  Â  <img src="https://drfmedia.com/favicon.ico" alt="DRFMedia Logo" />
Â  Â  Â  <h1>DRFMedia Timeline</h1>
Â  Â  </div>
Â  Â  <div>
Â  Â  Â  <button id="loginBtn">Login with Google</button>
Â  Â  Â  <button id="logoutBtn" style="display:none;">Logout</button>
Â  Â  </div>
Â  </header>

Â  <div id="postContainer" aria-live="polite"></div>

Â  <!-- Skrill Donation Modal -->
Â  <div id="skrillModal" role="dialog" aria-modal="true" aria-labelledby="skrillModalTitle" aria-describedby="skrillModalDesc">
Â  Â  <div id="skrillModalContent">
Â  Â  Â  <h2 id="skrillModalTitle">Skrill Donation</h2>
Â  Â  Â  <p id="skrillModalDesc">
Â  Â  Â  Â  Email: <strong>digitalrufiyacoin@gmail.com</strong><br />
Â  Â  Â  Â  Amount: $<strong id="skrillAmount">1</strong>
Â  Â  Â  </p>
Â  Â  Â  <img id="skrillQRCode" src="https://api.qrserver.com/v1/create-qr-code/?data=digitalrufiyacoin%40gmail.com&size=180x180" alt="Skrill QR Code" />
Â  Â  Â  <button id="openSkrillSiteBtn" type="button">Open Skrill.com</button>
Â  Â  Â  <button id="closeSkrillModalBtn" type="button" style="margin-top:12px; background:#ccc; color:#000;">Close</button>
Â  Â  </div>
Â  </div>

Â  <script type="module">
Â  Â  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-app.js";
Â  Â  import {
Â  Â  Â  getDatabase, ref, push, runTransaction, onValue
Â  Â  } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-database.js";
Â  Â  import {
Â  Â  Â  getAuth, signInWithPopup, signOut, GoogleAuthProvider, onAuthStateChanged
Â  Â  } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-auth.js";

Â  Â  const firebaseConfig = {
Â  Â  Â  apiKey: "AIzaSyB-W_j74lsbmJUFnTbJpn79HM62VLmkQC8",
Â  Â  Â  authDomain: "drfsocial-23a06.firebaseapp.com",
Â  Â  Â  databaseURL: "https://drfsocial-23a06-default-rtdb.firebaseio.com",
Â  Â  Â  projectId: "drfsocial-23a06",
Â  Â  Â  storageBucket: "drfsocial-23a06.appspot.com",
Â  Â  Â  messagingSenderId: "608135115201",
Â  Â  Â  appId: "1:608135115201:web:dc999df2c0c37241ff3f40"
Â  Â  };

Â  Â  const app = initializeApp(firebaseConfig);
Â  Â  const db = getDatabase(app);
Â  Â  const auth = getAuth(app);
Â  Â  const provider = new GoogleAuthProvider();

Â  Â  const loginBtn = document.getElementById("loginBtn");
Â  Â  const logoutBtn = document.getElementById("logoutBtn");
Â  Â  const postContainer = document.getElementById("postContainer");

Â  Â  // Skrill modal elements
Â  Â  const skrillModal = document.getElementById("skrillModal");
Â  Â  const skrillAmountSpan = document.getElementById("skrillAmount");
Â  Â  const openSkrillSiteBtn = document.getElementById("openSkrillSiteBtn");
Â  Â  const closeSkrillModalBtn = document.getElementById("closeSkrillModalBtn");

Â  Â  let currentUser = null;
Â  Â  let allPosts = [];

Â  Â  // Escape HTML helper to prevent XSS
Â  Â  function escapeHTML(str) {
Â  Â  Â  return String(str).replace(/[&<>"]/g, c => ({ "&": "&amp;", "<": "&lt;", ">": "&gt;", '"': "&quot;" }[c]));
Â  Â  }

Â  Â  // Placeholders for avatar
Â  Â  const placeholderAvatar40 = 'https://via.placeholder.com/40?text=User';
Â  Â  const placeholderAvatar30 = 'https://via.placeholder.com/30?text=User';

Â  Â  onAuthStateChanged(auth, user => {
Â  Â  Â  currentUser = user;
Â  Â  Â  loginBtn.style.display = user ? "none" : "inline-block";
Â  Â  Â  logoutBtn.style.display = user ? "inline-block" : "none";
Â  Â  Â  renderPosts();
Â  Â  });

Â  Â  loginBtn.onclick = () => signInWithPopup(auth, provider).catch(e => alert("Login failed: " + e.message));
Â  Â  logoutBtn.onclick = () => signOut(auth).catch(e => alert("Logout failed: " + e.message));

Â  Â  // Listen for posts realtime updates
Â  Â  const postsRef = ref(db, "posts");
Â  Â  onValue(postsRef, snapshot => {
Â  Â  Â  const posts = snapshot.val() || {};
Â  Â  Â  allPosts = Object.entries(posts).map(([id, post]) => ({ id, ...post }));
Â  Â  Â  allPosts.sort((a, b) => b.timestamp - a.timestamp);
Â  Â  Â  renderPosts();
Â  Â  });

Â  Â  // Fallback for video source loading error - try next gateway
Â  Â  window.switchGateway = function(videoElem) {
Â  Â  Â  let idx = parseInt(videoElem.dataset.idx || "1");
Â  Â  Â  const g1 = videoElem.dataset.g1;
Â  Â  Â  const g2 = videoElem.dataset.g2;
Â  Â  Â  const g3 = videoElem.dataset.g3;

Â  Â  Â  idx++;
Â  Â  Â  if (idx > 3) {
Â  Â  Â  Â  // no more fallbacks, stop trying
Â  Â  Â  Â  videoElem.onerror = null;
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  let nextSrc = "";
Â  Â  Â  if (idx === 2) nextSrc = g2;
Â  Â  Â  else if (idx === 3) nextSrc = g3;

Â  Â  Â  videoElem.dataset.idx = idx;
Â  Â  Â  videoElem.src = nextSrc;
Â  Â  Â  videoElem.load();
Â  Â  Â  videoElem.play().catch(() => {}); // ignore play errors
Â  Â  };

Â  Â  // IntersectionObserver for video lazy loading & auto play/pause
Â  Â  const videoObserver = new IntersectionObserver((entries) => {
Â  Â  Â  entries.forEach(entry => {
Â  Â  Â  Â  const video = entry.target;
Â  Â  Â  Â  if (entry.isIntersecting) {
Â  Â  Â  Â  Â  // Load & play video when visible
Â  Â  Â  Â  Â  if (!video.src) {
Â  Â  Â  Â  Â  Â  video.src = video.dataset.g1;
Â  Â  Â  Â  Â  Â  video.load();
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  video.play().catch(() => {});
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  // Pause and unload when not visible
Â  Â  Â  Â  Â  video.pause();
Â  Â  Â  Â  Â  // Optional: unload video to save memory
Â  Â  Â  Â  Â  // video.removeAttribute('src');
Â  Â  Â  Â  Â  // video.load();
Â  Â  Â  Â  }
Â  Â  Â  });
Â  Â  }, {
Â  Â  Â  threshold: 0.5
Â  Â  });

Â  Â  function renderPosts() {
Â  Â  Â  postContainer.innerHTML = "";
Â  Â  Â  if (!allPosts.length) {
Â  Â  Â  Â  postContainer.innerHTML = `<p style="padding:20px; text-align:center;">No posts available yet.</p>`;
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  for (const post of allPosts) {
Â  Â  Â  Â  const ipfsHash = post.ipfsHash || "";
Â  Â  Â  Â  const isVideo = post.mediaType === "video";
Â  Â  Â  Â  const url1 = `https://gateway.pinata.cloud/ipfs/${ipfsHash}`;
Â  Â  Â  Â  const url2 = `https://cloudflare-ipfs.com/ipfs/${ipfsHash}`;
Â  Â  Â  Â  const url3 = `https://ipfs.io/ipfs/${ipfsHash}`;

Â  Â  Â  Â  const mediaHTML = isVideo
Â  Â  Â  Â  Â  ? `<video controls preload="none" poster="${url2}" data-g1="${url1}" data-g2="${url2}" data-g3="${url3}" data-idx="0" onerror="switchGateway(this)" style="border-radius:6px; width:100%;"></video>`
Â  Â  Â  Â  Â  : `<img src="${url1}" alt="Post media" loading="lazy" onerror="this.onerror=null;this.src='${url2}'" style="border-radius:6px;" />`;

Â  Â  Â  Â  const isLiked = currentUser && post.likesBy && post.likesBy[currentUser.uid];
Â  Â  Â  Â  const isBoosted = currentUser && post.boostedBy && post.boostedBy[currentUser.uid];

Â  Â  Â  Â  const article = document.createElement("article");
Â  Â  Â  Â  article.className = "post-item";
Â  Â  Â  Â  article.innerHTML = `
Â  Â  Â  Â  Â  <header class="post-owner">
Â  Â  Â  Â  Â  Â  <img src="${escapeHTML(post.photoURL || placeholderAvatar40)}" alt="User avatar" class="avatar" />
Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  <div>${escapeHTML(post.displayName || "Anonymous")}</div>
Â  Â  Â  Â  Â  Â  Â  <small>${new Date(post.timestamp).toLocaleString()}</small>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  </header>
Â  Â  Â  Â  Â  <div class="post-caption">${escapeHTML(post.caption)}</div>
Â  Â  Â  Â  Â  <div class="post-media">${mediaHTML}</div>
Â  Â  Â  Â  Â  <div class="post-actions">
Â  Â  Â  Â  Â  Â  <button class="${isLiked ? "liked" : ""}" aria-pressed="${isLiked ? "true" : "false"}" aria-label="Like post" data-id="${post.id}">ğŸ‘ Like (${post.likesCount || 0})</button>
Â  Â  Â  Â  Â  Â  <button aria-label="Comment on post" data-id="${post.id}">ğŸ’¬ Comment (${post.commentsCount || 0})</button>
Â  Â  Â  Â  Â  Â  <button class="${isBoosted ? "boosted" : ""}" aria-pressed="${isBoosted ? "true" : "false"}" aria-label="Boost post" data-id="${post.id}">ğŸš€ Boost (${post.boostsCount || 0})</button>
Â  Â  Â  Â  Â  Â  <button aria-label="Donate to post" data-id="${post.id}">ğŸ Donate</button>
Â  Â  Â  Â  Â  Â  ${currentUser && post.uid === currentUser.uid ? `<button aria-label="Delete post" data-id="${post.id}">ğŸ—‘ï¸ Delete</button>` : ""}
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div class="comments-container" aria-live="polite"></div>
Â  Â  Â  Â  Â  <form class="comment-form" data-id="${post.id}" aria-label="Add comment">
Â  Â  Â  Â  Â  Â  <input type="text" name="comment" placeholder="Add a comment..." aria-required="true" />
Â  Â  Â  Â  Â  Â  <button type="submit">Send</button>
Â  Â  Â  Â  Â  </form>
Â  Â  Â  Â  `;

Â  Â  Â  Â  postContainer.appendChild(article);

Â  Â  Â  Â  // Observe video
Â  Â  Â  Â  if (isVideo) {
Â  Â  Â  Â  Â  const videoElem = article.querySelector("video");
Â  Â  Â  Â  Â  videoObserver.observe(videoElem);
Â  Â  Â  Â  }
Â  Â  Â  }

Â  Â  Â  // Attach event listeners for buttons (like, comment, boost, donate, delete)
Â  Â  Â  attachPostActions();
Â  Â  }

Â  Â  function attachPostActions() {
Â  Â  Â  // Like buttons
Â  Â  Â  postContainer.querySelectorAll(".post-actions button").forEach(btn => {
Â  Â  Â  Â  const postId = btn.dataset.id;
Â  Â  Â  Â  if (!postId) return;

Â  Â  Â  Â  if (btn.textContent.startsWith("ğŸ‘")) {
Â  Â  Â  Â  Â  btn.onclick = () => toggleLike(postId, btn);
Â  Â  Â  Â  } else if (btn.textContent.startsWith("ğŸ’¬")) {
Â  Â  Â  Â  Â  btn.onclick = () => focusCommentInput(postId);
Â  Â  Â  Â  } else if (btn.textContent.startsWith("ğŸš€")) {
Â  Â  Â  Â  Â  btn.onclick = () => toggleBoost(postId, btn);
Â  Â  Â  Â  } else if (btn.textContent.startsWith("ğŸ")) {
Â  Â  Â  Â  Â  btn.onclick = () => openDonationModal(postId);
Â  Â  Â  Â  } else if (btn.textContent.startsWith("ğŸ—‘ï¸")) {
Â  Â  Â  Â  Â  btn.onclick = () => deletePost(postId);
Â  Â  Â  Â  }
Â  Â  Â  });

Â  Â  Â  // Comment forms submit
Â  Â  Â  postContainer.querySelectorAll(".comment-form").forEach(form => {
Â  Â  Â  Â  form.onsubmit = e => {
Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  const commentInput = form.querySelector('input[name="comment"]');
Â  Â  Â  Â  Â  const commentText = commentInput.value.trim();
Â  Â  Â  Â  Â  if (!commentText) return;
Â  Â  Â  Â  Â  addComment(form.dataset.id, commentText);
Â  Â  Â  Â  Â  commentInput.value = "";
Â  Â  Â  Â  };
Â  Â  Â  });

Â  Â  Â  // Render comments for each post
Â  Â  Â  allPosts.forEach(post => {
Â  Â  Â  Â  renderComments(post.id, post.comments || {});
Â  Â  Â  });
Â  Â  }

Â  Â  function toggleLike(postId, btn) {
Â  Â  Â  if (!currentUser) return alert("Please login to like.");
Â  Â  Â  const likeRef = ref(db, `posts/${postId}/likesBy/${currentUser.uid}`);
Â  Â  Â  runTransaction(likeRef, current => current ? null : true).then(() => {
Â  Â  Â  Â  // update count transactionally
Â  Â  Â  Â  const countRef = ref(db, `posts/${postId}/likesCount`);
Â  Â  Â  Â  runTransaction(countRef, count => (count || 0) + (btn.classList.contains("liked") ? -1 : 1));
Â  Â  Â  });
Â  Â  }

Â  Â  function toggleBoost(postId, btn) {
Â  Â  Â  if (!currentUser) return alert("Please login to boost.");
Â  Â  Â  const boostRef = ref(db, `posts/${postId}/boostedBy/${currentUser.uid}`);
Â  Â  Â  runTransaction(boostRef, current => current ? null : true).then(() => {
Â  Â  Â  Â  const countRef = ref(db, `posts/${postId}/boostsCount`);
Â  Â  Â  Â  runTransaction(countRef, count => (count || 0) + (btn.classList.contains("boosted") ? -1 : 1));
Â  Â  Â  });
Â  Â  }

Â  Â  function focusCommentInput(postId) {
Â  Â  Â  const form = postContainer.querySelector(`.comment-form[data-id="${postId}"]`);
Â  Â  Â  if (form) form.querySelector('input[name="comment"]').focus();
Â  Â  }

Â  Â  function addComment(postId, commentText) {
Â  Â  Â  if (!currentUser) return alert("Please login to comment.");
Â  Â  Â  const commentsRef = ref(db, `posts/${postId}/comments`);
Â  Â  Â  const newComment = {
Â  Â  Â  Â  uid: currentUser.uid,
Â  Â  Â  Â  displayName: currentUser.displayName || "Anonymous",
Â  Â  Â  Â  photoURL: currentUser.photoURL || placeholderAvatar30,
Â  Â  Â  Â  text: commentText,
Â  Â  Â  Â  timestamp: Date.now()
Â  Â  Â  };
Â  Â  Â  push(commentsRef, newComment).then(() => {
Â  Â  Â  Â  // update comments count
Â  Â  Â  Â  const countRef = ref(db, `posts/${postId}/commentsCount`);
Â  Â  Â  Â  runTransaction(countRef, count => (count || 0) + 1);
Â  Â  Â  });
Â  Â  }

Â  Â  function renderComments(postId, comments) {
Â  Â  Â  const container = postContainer.querySelector(`.post-item .comments-container`);
Â  Â  Â  const postElem = [...postContainer.children].find(el => el.querySelector(`.comment-form[data-id="${postId}"]`));
Â  Â  Â  if (!postElem) return;
Â  Â  Â  const commentsContainer = postElem.querySelector(".comments-container");
Â  Â  Â  commentsContainer.innerHTML = "";

Â  Â  Â  const commentsArr = Object.values(comments);
Â  Â  Â  commentsArr.sort((a,b) => a.timestamp - b.timestamp);

Â  Â  Â  commentsArr.forEach(c => {
Â  Â  Â  Â  const div = document.createElement("div");
Â  Â  Â  Â  div.className = "comment";
Â  Â  Â  Â  div.innerHTML = `
Â  Â  Â  Â  Â  <img src="${escapeHTML(c.photoURL || placeholderAvatar30)}" alt="User avatar" class="avatar" />
Â  Â  Â  Â  Â  <div class="comment-body">
Â  Â  Â  Â  Â  Â  <strong>${escapeHTML(c.displayName)}</strong>
Â  Â  Â  Â  Â  Â  <span>${escapeHTML(c.text)}</span>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  `;
Â  Â  Â  Â  commentsContainer.appendChild(div);
Â  Â  Â  });
Â  Â  }

Â  Â  // Listen for comments realtime
Â  Â  function listenComments() {
Â  Â  Â  allPosts.forEach(post => {
Â  Â  Â  Â  const commentsRef = ref(db, `posts/${post.id}/comments`);
Â  Â  Â  Â  onValue(commentsRef, snapshot => {
Â  Â  Â  Â  Â  renderComments(post.id, snapshot.val() || {});
Â  Â  Â  Â  });
Â  Â  Â  });
Â  Â  }

Â  Â  // Call once after initial load
Â  Â  listenComments();

Â  Â  function openDonationModal(postId) {
Â  Â  Â  if (!currentUser) return alert("Please login to donate.");
Â  Â  Â  skrillAmountSpan.textContent = "1"; // Default 1 USD
Â  Â  Â  skrillModal.style.display = "flex";
Â  Â  }

Â  Â  openSkrillSiteBtn.onclick = () => {
Â  Â  Â  window.open("https://www.skrill.com/en/", "_blank");
Â  Â  };

Â  Â  closeSkrillModalBtn.onclick = () => {
Â  Â  Â  skrillModal.style.display = "none";
Â  Â  };

Â  Â  function deletePost(postId) {
Â  Â  Â  if (!currentUser) return alert("Please login to delete posts.");
Â  Â  Â  if (!confirm("Are you sure you want to delete this post?")) return;
Â  Â  Â  const postRef = ref(db, `posts/${postId}`);
Â  Â  Â  postRef.remove().catch(e => alert("Failed to delete: " + e.message));
Â  Â  }
Â  </script>
</body>
</html>
