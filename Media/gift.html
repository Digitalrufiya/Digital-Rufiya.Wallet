<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DRFMedia Timeline ‚Äî With Donations</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    /* Additions for donation UI */
    .donate-btns {
      margin-top: 10px;
    }
    .donate-btns button {
      margin: 3px;
      padding: 6px 10px;
      border: none;
      border-radius: 4px;
      font-size: 0.9em;
      cursor: pointer;
      color: white;
    }
    .rose { background: #e91e63; }
    .lion { background: #f39c12; }
    .dua  { background: #009688; }
    .star { background: #673ab7; }
    .highlight-btn {
      margin-top: 10px;
      background: gold;
      color: black;
      font-weight: bold;
      border: none;
      border-radius: 4px;
      padding: 6px 10px;
    }
  </style>
</head>
<body>
<!-- Existing content above remains unchanged -->
<!-- Add this after each post card in renderPosts() inside JS -->
<div class="donate-btns">
  <button class="rose" onclick="donateCoins('${post.id}','rose')">üåπ Rose ($1)</button>
  <button class="lion" onclick="donateCoins('${post.id}','lion')">ü¶Å Lion ($10)</button>
  <button class="dua" onclick="donateCoins('${post.id}','dua')">üôè Dua ($20)</button>
  <button class="star" onclick="donateCoins('${post.id}','star')">‚ú® Star ($30)</button>
</div>
<button class="highlight-btn" disabled>üîí Only admin can highlight verified posts</button>

<!-- Withdraw request form -->
<div id="walletInfo" style="display:none; max-width: 700px; margin: 20px auto; background: #eee; padding: 15px; border-radius: 6px;">
  <div>Welcome <strong id="userDisplayName"></strong> | Coins: <strong id="userCoins">0</strong></div>
  <button onclick="document.getElementById('withdrawBox').style.display='block'">Request Withdrawal</button>
</div>
<div id="withdrawBox" style="display:none; max-width: 600px; margin: 20px auto;">
  <h3>Withdrawal Request</h3>
  <input type="number" id="withdrawAmount" placeholder="Amount to withdraw (coins)" style="width:100%; padding:8px;" />
  <textarea id="withdrawInfo" placeholder="Enter payment details (bank, wallet etc)" style="width:100%; padding:8px; margin-top:10px;"></textarea>
  <button onclick="submitWithdraw()" style="margin-top:10px; padding: 10px 20px; background:#007bff; color:white; border:none; border-radius:4px;">Submit Request</button>
</div>

<script type="module">
// Add to your Firebase config
import { getDatabase, ref, get, set, push } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-database.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-auth.js";

const db = getDatabase();
const auth = getAuth();

let currentUser = null;
const userCoins = document.getElementById("userCoins");
const userDisplayName = document.getElementById("userDisplayName");

onAuthStateChanged(auth, async user => {
  currentUser = user;
  if (!user) return;
  document.getElementById("walletInfo").style.display = "block";
  userDisplayName.textContent = user.displayName || "User";
  const coinsRef = ref(db, `coins/${user.uid}`);
  const snap = await get(coinsRef);
  userCoins.textContent = snap.exists() ? snap.val() : 0;
});

// Donation function
window.donateCoins = async function(postId, type) {
  if (!currentUser) return alert("Please sign in to donate.");

  const coinMap = { rose: 1, lion: 10, dua: 20, star: 30 };
  const value = coinMap[type];

  const postRef = ref(db, `posts/${postId}`);
  const postSnap = await get(postRef);
  if (!postSnap.exists()) return alert("Post not found.");

  const post = postSnap.val();
  const verifiedRef = ref(db, `userVerifications/${post.userId}/verificationStatus`);
  const verifiedSnap = await get(verifiedRef);

  if (!verifiedSnap.exists() || verifiedSnap.val() !== true) return alert("Post owner is not verified to receive donations.");

  const coinsRef = ref(db, `coins/${post.userId}`);
  const coinSnap = await get(coinsRef);
  const prev = coinSnap.exists() ? coinSnap.val() : 0;
  await set(coinsRef, prev + value);
  alert("Donation successful!");
};

// Withdraw request
window.submitWithdraw = async function() {
  if (!currentUser) return alert("Login first.");
  const amt = parseInt(document.getElementById("withdrawAmount").value);
  const info = document.getElementById("withdrawInfo").value.trim();
  if (!amt || !info) return alert("Please fill all fields.");

  const reqRef = push(ref(db, `withdrawals/${currentUser.uid}`));
  await set(reqRef, {
    amount: amt,
    info,
    status: "Pending",
    timestamp: Date.now()
  });
  alert("Withdraw request submitted.");
  document.getElementById("withdrawBox").style.display = "none";
};
</script>
</body>
</html>
