<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Digital Rufiya (DrF) Charity Donation</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');

    :root {
      --background: #121217;
      --surface: #1E1E2F;
      --primary: #4ade80; /* green */
      --primary-hover: #22c55e;
      --text-primary: #d1d5db;
      --text-secondary: #a1a1aa;
      --shadow: rgba(0,0,0,0.4);
      --error: #ef4444;
      --success: #22c55e;
    }

    * {
      box-sizing: border-box;
      transition: all 0.3s ease;
    }

    body {
      margin: 0;
      font-family: 'Inter', sans-serif;
      background: var(--background);
      color: var(--text-primary);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 1rem;
    }

    .container {
      background: var(--surface);
      border-radius: 20px;
      box-shadow: 0 8px 24px var(--shadow);
      max-width: 480px;
      width: 100%;
      padding: 2rem 2.5rem;
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }

    h2 {
      font-weight: 600;
      font-size: 1.8rem;
      text-align: center;
      color: var(--primary);
      user-select: none;
    }

    .address-box {
      background: #2a2a3c;
      padding: 0.7rem 1rem;
      border-radius: 12px;
      font-family: 'Courier New', monospace;
      font-weight: 600;
      letter-spacing: 1.2px;
      user-select: all;
      overflow-wrap: break-word;
      text-align: center;
      color: var(--text-secondary);
    }

    button, input {
      outline: none;
      border: none;
      font-size: 1.1rem;
      border-radius: 16px;
      padding: 0.9rem 1.2rem;
      box-shadow:
        inset 4px 4px 6px #16161f,
        inset -4px -4px 6px #24243d;
      background: var(--surface);
      color: var(--text-primary);
      font-weight: 500;
      width: 100%;
      cursor: pointer;
      user-select: none;
      transition: box-shadow 0.3s ease, background 0.3s ease;
    }

    input {
      text-align: center;
      font-weight: 600;
      letter-spacing: 0.5px;
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      color: var(--text-primary);
    }

    input::placeholder {
      color: var(--text-secondary);
      font-weight: 400;
    }

    input:focus {
      box-shadow:
        inset 2px 2px 5px #16161f,
        inset -2px -2px 5px #24243d,
        0 0 8px var(--primary);
      color: var(--primary);
    }

    button:hover:not(:disabled) {
      background: var(--primary);
      color: #121217;
      box-shadow:
        4px 4px 12px var(--primary),
        -4px -4px 12px var(--primary-hover);
    }

    button:disabled {
      cursor: not-allowed;
      opacity: 0.5;
      box-shadow: none;
      background: #2a2a3c;
      color: var(--text-secondary);
    }

    .btn-switch-network {
      background: #fbbf24; /* amber */
      color: #121217;
      font-weight: 600;
      margin-top: 0.5rem;
      box-shadow: 0 0 10px #fbbf24aa;
    }

    .btn-switch-network:hover {
      background: #f59e0b;
      box-shadow: 0 0 20px #f59e0baa;
    }

    .status-message {
      font-weight: 600;
      text-align: center;
      user-select: text;
      padding: 0.75rem 1rem;
      border-radius: 14px;
      font-size: 1rem;
      margin-top: 0.5rem;
      line-height: 1.3;
    }

    .status-info {
      background: #334155;
      color: var(--text-primary);
      box-shadow: inset 2px 2px 8px #1e293b, inset -2px -2px 8px #475569;
    }

    .status-success {
      background: #14532d;
      color: #a7f3d0;
      box-shadow: inset 2px 2px 8px #064e3b, inset -2px -2px 8px #166534;
    }

    .status-error {
      background: #7f1d1d;
      color: #fecaca;
      box-shadow: inset 2px 2px 8px #6b1212, inset -2px -2px 8px #991b1b;
    }

    .referral-section {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      user-select: none;
    }

    .referral-section input {
      cursor: pointer;
      user-select: all;
      font-weight: 600;
    }

    .copy-btn {
      background: var(--primary);
      color: #121217;
      font-weight: 700;
      letter-spacing: 0.05em;
      transition: background 0.2s ease;
    }
    .copy-btn:hover {
      background: var(--primary-hover);
    }

    @media (max-width: 480px) {
      .container {
        padding: 1.5rem 1.5rem;
        border-radius: 16px;
      }
      h2 {
        font-size: 1.5rem;
      }
    }
  </style>
</head>
<body>

  <main class="container" role="main" aria-label="Charity Donation">

    <h2>Digital Rufiya (DrF) Charity Donation</h2>

    <section aria-labelledby="charity-wallet-label">
      <p id="charity-wallet-label" style="font-weight:600; text-align:center; color: var(--primary); margin-bottom:0.5rem;">Charity Wallet Address (USDC on BSC)</p>
      <div class="address-box" aria-live="polite" aria-atomic="true" tabindex="0" role="textbox" aria-label="Charity wallet address">
        0x88253D87990EdD1E647c3B6eD21F57fb061a3040
      </div>
    </section>

    <button id="connectWalletBtn" type="button" aria-live="polite" aria-atomic="true" aria-describedby="walletStatus" aria-label="Connect wallet to start donating">Connect Wallet</button>

    <label for="donateAmount" style="margin-top:1rem; font-weight:600;">Donation Amount (USDC)</label>
    <input
      id="donateAmount"
      type="number"
      min="0"
      step="0.01"
      placeholder="Enter amount"
      aria-describedby="donateAmountDesc"
      aria-required="true"
      autocomplete="off"
    />
    <div id="donateAmountDesc" style="color: var(--text-secondary); font-size: 0.85rem; margin-top: 0.2rem; margin-bottom: 1rem;">
      Enter how much USDC you want to donate.
    </div>

    <button id="donateBtn" type="button" disabled aria-live="polite" aria-atomic="true">Donate Charity</button>

    <button id="switchNetworkBtn" type="button" class="btn-switch-network" style="display:none;" aria-live="polite" aria-atomic="true" aria-label="Switch to Binance Smart Chain network">
      Switch to BSC Network
    </button>

    <div id="statusMsg" role="status" aria-live="polite" aria-atomic="true"></div>

    <section class="referral-section" aria-labelledby="referral-label" style="margin-top: 2rem;">
      <h3 id="referral-label" style="color: var(--primary); user-select:none;">Your Referral Link (Optional)</h3>
      <input id="refLinkInput" type="text" readonly aria-label="Referral link" />
      <button id="copyReferralBtn" type="button" class="copy-btn" aria-describedby="copyStatus" aria-live="polite" aria-atomic="true">Copy Referral Link</button>
      <div id="copyStatus" style="font-size:0.85rem; color: var(--primary); min-height: 1.2em; margin-top: 0.3rem;"></div>
    </section>

  </main>

<script>
  const charityAddress = "0x88253D87990EdD1E647c3B6eD21F57fb061a3040"; // Charity USDC wallet
  const usdcAddress = "0x8ac76a51cc950d9822d68b83fe1ad97b32cd580d"; // BSC USDC contract

  let userAddress = null;

  const connectBtn = document.getElementById("connectWalletBtn");
  const donateBtn = document.getElementById("donateBtn");
  const switchBtn = document.getElementById("switchNetworkBtn");
  const donateAmountInput = document.getElementById("donateAmount");
  const statusMsg = document.getElementById("statusMsg");
  const refLinkInput = document.getElementById("refLinkInput");
  const copyReferralBtn = document.getElementById("copyReferralBtn");
  const copyStatus = document.getElementById("copyStatus");

  async function connectWallet() {
    if (window.ethereum) {
      try {
        const accounts = await ethereum.request({ method: 'eth_requestAccounts' });
        userAddress = accounts[0];
        connectBtn.textContent = `Connected: ${userAddress.slice(0,6)}...${userAddress.slice(-4)}`;
        connectBtn.disabled = true;
        checkDonateButton();
        setupReferralLink();
        statusMsg.textContent = "";
        await checkNetwork();
      } catch (e) {
        alert("Wallet connection rejected.");
      }
    } else {
      alert("MetaMask or compatible wallet not found.");
    }
  }

  async function checkNetwork() {
    if (!window.ethereum) return;

    const chainId = await ethereum.request({ method: 'eth_chainId' });
    if (chainId !== "0x38") {
      statusMsg.innerHTML = `<div class="status-message status-info">Please switch to Binance Smart Chain to donate.</div>`;
      switchBtn.style.display = "block";
      donateBtn.disabled = true;
    } else {
      statusMsg.innerHTML = "";
      switchBtn.style.display = "none";
      checkDonateButton();
    }
  }

  async function switchNetwork() {
    try {
      await ethereum.request({
        method: 'wallet_switchEthereumChain',
        params: [{ chainId: '0x38' }]
      });
      statusMsg.innerHTML = `<div class="status-message status-success">Switched to BSC network.</div>`;
      switchBtn.style.display = "none";
      checkDonateButton();
    } catch (err) {
      statusMsg.innerHTML = `<div class="status-message status-error">Failed to switch network: ${err.message}</div>`;
    }
  }

  function checkDonateButton() {
    const amount = parseFloat(donateAmountInput.value);
    if (userAddress && amount > 0) {
      donateBtn.disabled = false;
    } else {
      donateBtn.disabled = true;
    }
  }

  async function donateCharity() {
    const amount = parseFloat(donateAmountInput.value);
    if (!userAddress || isNaN(amount) || amount <= 0) {
      alert("Please connect wallet and enter a valid amount.");
      return;
    }

    const chainId = await ethereum.request({ method: 'eth_chainId' });
    if (chainId !== "0x38") {
      alert("Please switch to BSC network first.");
      return;
    }

    // USDC has 6 decimals on BSC
    const amountInDecimals = BigInt(amount * 1e6).toString();

    const methodId = "0xa9059cbb";
    const toAddressPadded = charityAddress.toLowerCase().replace("0x", "").padStart(64, "0");
    const amountPadded = amountInDecimals.toString(16).padStart(64, "0");
    const data = methodId + toAddressPadded + amountPadded;

    const txParams = {
      from: userAddress,
      to: usdcAddress,
      data: data,
    };

    try {
      statusMsg.innerHTML = `<div class="status-message status-info">Sending transaction...</div>`;
      const txHash = await ethereum.request({
        method: "eth_sendTransaction",
        params: [txParams]
      });
      statusMsg.innerHTML = `<div class="status-message status-success">Transaction sent! Hash: <a href="https://bscscan.com/tx/${txHash}" target="_blank" rel="noopener noreferrer">${txHash}</a></div>`;
      donateAmountInput.value = "";
      donateBtn.disabled = true;
    } catch (error) {
      statusMsg.innerHTML = `<div class="status-message status-error">Transaction failed: ${error.message}</div>`;
    }
  }

  function setupReferralLink() {
    const url = new URL(window.location.href);
    const ref = url.searchParams.get("ref") || userAddress || "";
    const link = `${window.location.origin}${window.location.pathname}?ref=${ref}`;
    refLinkInput.value = link;
  }

  copyReferralBtn.onclick = () => {
    refLinkInput.select();
    navigator.clipboard.writeText(refLinkInput.value).then(() => {
      copyStatus.textContent = "Referral link copied!";
      setTimeout(() => (copyStatus.textContent = ""), 3000);
    });
  };

  connectBtn.onclick = connectWallet;
  switchBtn.onclick = switchNetwork;
  donateAmountInput.addEventListener("input", checkDonateButton);
  donateBtn.onclick = donateCharity;

  if (window.ethereum) {
    window.ethereum.on("chainChanged", () => window.location.reload());
    window.ethereum.on("accountsChanged", () => window.location.reload());
  }
</script>

</body>
</html>
