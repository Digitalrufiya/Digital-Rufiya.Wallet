<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>DRF Wallet â€” Pay Request</title>
<style>
  body { font-family: Arial, sans-serif; max-width: 480px; margin: auto; padding: 20px; background: #f9f9f9; }
  .request-details { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 0 6px #ccc; }
  button { background: #28a745; color: white; border: none; padding: 10px; border-radius: 6px; cursor: pointer; margin-top: 15px; width: 100%; }
  button:hover { background: #1e7e34; }
  .error { color: red; }
</style>
</head>
<body>
<h2>Payment Request</h2>

<div id="content">
  <p>Loading request...</p>
</div>

<script>
  const STORAGE_KEY = 'drf_payment_requests';

  function getRequests() {
    const raw = localStorage.getItem(STORAGE_KEY);
    return raw ? JSON.parse(raw) : [];
  }

  function findRequestById(id) {
    const requests = getRequests();
    return requests.find(r => r.id === id);
  }

  function getQueryParam(name) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(name);
  }

  function payNow(request) {
    alert(`To pay ${request.amount} DRF, please open your DRF Wallet and send the amount to the wallet address shown there.\n\nMessage: ${request.message || 'No message'}`);
  }

  window.onload = () => {
    const id = getQueryParam('id');
    const contentDiv = document.getElementById('content');
    if (!id) {
      contentDiv.innerHTML = '<p class="error">No payment request ID found in the URL.</p>';
      return;
    }
    const request = findRequestById(id);
    if (!request) {
      contentDiv.innerHTML = '<p class="error">Payment request not found or expired.</p>';
      return;
    }
    contentDiv.innerHTML = `
      <div class="request-details">
        <p><strong>Amount:</strong> ${request.amount} DRF</p>
        <p><strong>Message:</strong> ${request.message || '<em>No message</em>'}</p>
        <button onclick="payNow(request)">Pay Now</button>
      </div>
    `;
  };
</script>
</body>
</html>
