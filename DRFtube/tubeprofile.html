<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DRFTube Profile</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 0;
      background-color: #121212;
      color: #eee;
    }
    nav {
      display: flex;
      justify-content: center;
      gap: 20px;
      padding: 15px;
      background-color: #0a84ff;
    }
    nav a {
      color: #fff;
      text-decoration: none;
      font-weight: bold;
    }
    .container {
      max-width: 600px;
      margin: 30px auto;
      background: #1e1e1e;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 10px #0a84ff88;
    }
    h2 {
      color: #0affff;
    }
    input, textarea, select {
      width: 100%;
      margin-bottom: 12px;
      padding: 10px;
      border-radius: 8px;
      border: none;
      font-size: 1rem;
      background: #2b2b2b;
      color: #eee;
    }
    button {
      padding: 10px 20px;
      background: #0a84ff;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
    }
    button:disabled {
      background: #555;
      cursor: not-allowed;
    }
  </style>
</head>
<body>
  <nav>
    <a href="tube.html">üè† Home</a>
    <a href="tubeupload.html">‚¨ÜÔ∏è Upload</a>
    <a href="profile.html">üë§ Profile</a>
  </nav>

  <div class="container">
    <h2>Your Profile</h2>
    <input type="text" id="displayName" placeholder="Your display name" />
    <textarea id="bio" placeholder="Short bio"></textarea>
    <input type="text" id="wallet" placeholder="DRF Wallet Address" />
    <button id="saveBtn" disabled>Save Profile</button>
  </div>

  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js';
    import { getDatabase, ref, update, get } from 'https://www.gstatic.com/firebasejs/11.9.1/firebase-database.js';
    import { getAuth, onAuthStateChanged, updateProfile } from 'https://www.gstatic.com/firebasejs/11.9.1/firebase-auth.js';

    const firebaseConfig = {
      apiKey: "AIzaSyCdFX1PbNEgubM4Zib7U-hgtJbSOONPk6U",
      authDomain: "drftube-634c6.firebaseapp.com",
      projectId: "drftube-634c6",
      storageBucket: "drftube-634c6.appspot.com",
      messagingSenderId: "819828633864",
      appId: "1:819828633864:web:513002b461259b000cbcbd",
      measurementId: "G-ZPTJE4DMNN",
      databaseURL: "https://drftube-634c6-default-rtdb.firebaseio.com"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const auth = getAuth(app);

    const displayNameInput = document.getElementById('displayName');
    const bioInput = document.getElementById('bio');
    const walletInput = document.getElementById('wallet');
    const saveBtn = document.getElementById('saveBtn');

    let currentUser = null;
    let initialData = {};

    function checkChanges() {
      const changed =
        displayNameInput.value.trim() !== (currentUser?.displayName || '') ||
        bioInput.value.trim() !== (initialData.bio || '') ||
        walletInput.value.trim() !== (initialData.wallet || '');
      saveBtn.disabled = !changed;
    }

    [displayNameInput, bioInput, walletInput].forEach(el => el.addEventListener('input', checkChanges));

    onAuthStateChanged(auth, async user => {
      if (!user) return location.href = 'tube.html';
      currentUser = user;
      displayNameInput.value = user.displayName || '';
      const snap = await get(ref(db, 'users/' + user.uid));
      if (snap.exists()) {
        initialData = snap.val();
        bioInput.value = initialData.bio || '';
        walletInput.value = initialData.wallet || '';
      }
      checkChanges();
    });

    saveBtn.onclick = async () => {
      if (!currentUser) return;
      saveBtn.disabled = true;
      saveBtn.textContent = 'Saving...';

      const updates = {
        bio: bioInput.value.trim(),
        wallet: walletInput.value.trim(),
      };

      if (displayNameInput.value.trim() !== currentUser.displayName) {
        await updateProfile(currentUser, { displayName: displayNameInput.value.trim() });
      }

      await update(ref(db, 'users/' + currentUser.uid), updates);
      alert('Profile updated.');
      saveBtn.textContent = 'Save Profile';
      initialData = { ...initialData, ...updates };
      checkChanges();
    };
  </script>
</body>
  </html>
  
