
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DRF Social DApp</title>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.9.0/firebase-analytics.js";
    const firebaseConfig = {
      apiKey: "AIzaSyB-W_j74lsbmJUFnTbJpn79HM62VLmkQC8",
      authDomain: "drfsocial-23a06.firebaseapp.com",
      databaseURL: "https://drfsocial-23a06-default-rtdb.firebaseio.com",
      projectId: "drfsocial-23a06",
      storageBucket: "drfsocial-23a06.firebasestorage.app",
      messagingSenderId: "608135115201",
      appId: "1:608135115201:web:dc999df2c0f37241ff3f40",
      measurementId: "G-W6VHMP77YR"
    };
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
  </script>
</head>
<body>
  <h1>Welcome to DRF Social DApp</h1>
  <button onclick="boostPost('examplePostId')">ðŸš€ Boost Post</button>

<!-- Add Web3 support -->
<script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>

<script>
  const USDC_ADDRESS = "0xd7D2802D433eEcE757Be13Ab06D09b3E7AbC390C";
  const BOOST_AMOUNT = "1000000"; // 1 USDC in 6 decimals (USDC uses 6)

  async function requestBoostPayment(postId) {
    if (!window.ethereum) {
      alert("Please install MetaMask or another Web3 wallet.");
      return;
    }

    const web3 = new Web3(window.ethereum);

    try {
      await window.ethereum.request({ method: "eth_requestAccounts" });
      const accounts = await web3.eth.getAccounts();
      const sender = accounts[0];

      const usdcContract = new web3.eth.Contract([
        {
          constant: false,
          inputs: [
            { name: "_to", type: "address" },
            { name: "_value", type: "uint256" }
          ],
          name: "transfer",
          outputs: [{ name: "", type: "bool" }],
          type: "function"
        }
      ], USDC_ADDRESS);

      const tx = await usdcContract.methods
        .transfer("0xd7D2802D433eEcE757Be13Ab06D09b3E7AbC390C", BOOST_AMOUNT)
        .send({ from: sender });

      if (tx.status) {
        alert("âœ… Boost payment successful!");
        await firebaseUpdateBoost(postId);
      } else {
        alert("âŒ Payment failed. Please try again.");
      }
    } catch (err) {
      console.error(err);
      alert("Payment cancelled or failed.");
    }
  }

  async function firebaseUpdateBoost(postId) {
    const db = getDatabase();
    const postRef = ref(db, `posts/${postId}`);
    await update(postRef, { boostTimestamp: Date.now() });
    alert("ðŸŽ‰ Post Boosted for 30 days!");
  }

  window.boostPost = async (postId) => {
    const confirmBoost = confirm("Boost your post for 1 USDC (BSC)?");
    if (!confirmBoost) return;

    const useWeb3 = confirm("Would you like to pay using a Web3 wallet (MetaMask, Trust Wallet, etc)?");

    if (useWeb3) {
      requestBoostPayment(postId);
    } else {
      alert("Boost cancelled. Payment required.");
    }
  };
</script>

</body>
</html>
