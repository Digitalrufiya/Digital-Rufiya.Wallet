<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DRF Marketing Dashboard</title>
  <!-- Tailwind Play CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Smooth scroll + utility */
    html { scroll-behavior: smooth; }
    .card { @apply bg-white border rounded-2xl shadow-sm; }
  </style>
  <!-- React / ReactDOM UMD -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <!-- Babel to run JSX in the browser -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <!-- Framer Motion UMD -->
  <script src="https://unpkg.com/framer-motion/dist/framer-motion.umd.js"></script>
  <!-- Recharts UMD + dependencies -->
  <script src="https://unpkg.com/recharts/umd/Recharts.min.js"></script>
</head>
<body class="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 text-slate-900">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useMemo } = React;
    const { motion, AnimatePresence } = window['framer-motion'];
    const {
      ResponsiveContainer, LineChart, Line, BarChart, Bar, XAxis, YAxis, Tooltip, CartesianGrid, PieChart, Pie, Cell
    } = Recharts;

    // ---- Helpers ----
    const cls = (...xs) => xs.filter(Boolean).join(' ');
    const load = (k, v) => { try { const s = localStorage.getItem(k); return s ? JSON.parse(s) : v; } catch { return v; } };
    const save = (k, v) => localStorage.setItem(k, JSON.stringify(v));

    const PLATFORMS = [
      { key: 'facebook', label: 'Facebook', hint: 'Pages & Groups' },
      { key: 'instagram', label: 'Instagram', hint: 'Business' },
      { key: 'x', label: 'X (Twitter)', hint: 'API v2' },
      { key: 'tiktok', label: 'TikTok', hint: 'Upload API' },
      { key: 'youtube', label: 'YouTube', hint: 'Cross-post' },
      { key: 'telegram', label: 'Telegram', hint: 'Channel/Bot' },
    ];

    const TAG_SUGGESTIONS = ['#DigitalRufiya', '#DRFMedia', '#DRFTube', '#Crypto', '#Web3', '#Maldives', '#BSC', '#DeFi'];

    const DEMO_SERIES = [
      { name: 'Mon', impressions: 2100, engagement: 220 },
      { name: 'Tue', impressions: 3400, engagement: 410 },
      { name: 'Wed', impressions: 2900, engagement: 380 },
      { name: 'Thu', impressions: 4100, engagement: 520 },
      { name: 'Fri', impressions: 4700, engagement: 680 },
      { name: 'Sat', impressions: 3900, engagement: 430 },
      { name: 'Sun', impressions: 5200, engagement: 800 },
    ];

    const PIE = [
      { name: 'TikTok', value: 36 },
      { name: 'YouTube', value: 22 },
      { name: 'Facebook', value: 18 },
      { name: 'Instagram', value: 14 },
      { name: 'X', value: 6 },
      { name: 'Telegram', value: 4 },
    ];

    function formatNumber(n){ try { return new Intl.NumberFormat().format(n); } catch { return String(n); } }

    // ---- App ----
    function App(){
      const [tab, setTab] = useState('home');
      const [connected, setConnected] = useState(load('drfmp-connected', {
        facebook:false, instagram:false, x:false, tiktok:false, youtube:false, telegram:false
      }));
      const [posts, setPosts] = useState(load('drfmp-posts', []));
      const [scheduled, setScheduled] = useState(load('drfmp-scheduled', []));
      const [toast, setToast] = useState(null);

      useEffect(()=> save('drfmp-connected', connected), [connected]);
      useEffect(()=> save('drfmp-posts', posts), [posts]);
      useEffect(()=> save('drfmp-scheduled', scheduled), [scheduled]);

      const totalFollowers = 12800; // demo placeholder
      const todayEngagement = 1540; // demo placeholder

      return (
        <div className="grid grid-cols-12">
          {/* Sidebar */}
          <aside className="col-span-12 md:col-span-3 lg:col-span-2 bg-white md:min-h-screen border-r md:sticky md:top-0">
            <div className="p-4 border-b">
              <h1 className="text-xl font-bold">DRF Marketing</h1>
              <p className="text-xs text-slate-500">Post everywhere in one click</p>
            </div>
            <nav className="p-2 space-y-1">
              <SideItem label="Dashboard" icon="🏠" active={tab==='home'} onClick={()=>setTab('home')} />
              <SideItem label="Create Post" icon="📝" active={tab==='create'} onClick={()=>setTab('create')} />
              <SideItem label="Schedule" icon="⏰" active={tab==='schedule'} onClick={()=>setTab('schedule')} />
              <SideItem label="Analytics" icon="📊" active={tab==='analytics'} onClick={()=>setTab('analytics')} />
              <SideItem label="Settings" icon="⚙️" active={tab==='settings'} onClick={()=>setTab('settings')} />
            </nav>
            <div className="p-4 border-t text-xs text-slate-500 flex items-center gap-2">
              💡 Tips: Post daily + 1 weekly giveaway
            </div>
          </aside>

          {/* Main */}
          <main className="col-span-12 md:col-span-9 lg:col-span-10 p-4 md:p-6">
            <Header onLogout={()=> setToast('Logged out (demo)')} />

            <AnimatePresence mode="wait">
              {tab==='home' && (
                <motion.div key="home" initial={{opacity:0, y:8}} animate={{opacity:1, y:0}} exit={{opacity:0, y:-8}} className="space-y-6">
                  <QuickStats totalFollowers={totalFollowers} todayEngagement={todayEngagement} />
                  <RecentPosts posts={posts} />
                </motion.div>
              )}

              {tab==='create' && (
                <motion.div key="create" initial={{opacity:0, y:8}} animate={{opacity:1, y:0}} exit={{opacity:0, y:-8}}>
                  <CreatePost
                    connected={connected}
                    onPost={(payload)=>{ setPosts(p=>[payload, ...p].slice(0, 50)); setToast('Posted to connected platforms (demo)'); }}
                    onSchedule={(item)=>{ setScheduled(s=>[item, ...s]); setToast('Scheduled successfully (demo)'); }}
                  />
                </motion.div>
              )}

              {tab==='schedule' && (
                <motion.div key="schedule" initial={{opacity:0, y:8}} animate={{opacity:1, y:0}} exit={{opacity:0, y:-8}}>
                  <ScheduleManager items={scheduled} onDelete={(id)=> setScheduled(s=>s.filter(x=>x.id!==id))} />
                </motion.div>
              )}

              {tab==='analytics' && (
                <motion.div key="analytics" initial={{opacity:0, y:8}} animate={{opacity:1, y:0}} exit={{opacity:0, y:-8}}>
                  <AnalyticsSection />
                </motion.div>
              )}

              {tab==='settings' && (
                <motion.div key="settings" initial={{opacity:0, y:8}} animate={{opacity:1, y:0}} exit={{opacity:0, y:-8}}>
                  <SettingsSection connected={connected} setConnected={setConnected} />
                </motion.div>
              )}
            </AnimatePresence>
          </main>
        </div>

        /* Toast */
        ,
        <Toast toast={toast} onClose={()=> setToast(null)} />
      );
    }

    function Header({ onLogout }){
      return (
        <div className="flex items-center justify-between mb-6">
          <div>
            <h2 className="text-2xl font-bold">Welcome, Hassan 👋</h2>
            <p className="text-sm text-slate-500">Ship your DRF content everywhere in one click.</p>
          </div>
          <div className="flex items-center gap-3">
            <button className="px-3 py-2 text-sm rounded-xl bg-white shadow-sm border">👥 Team</button>
            <button onClick={onLogout} className="px-3 py-2 text-sm rounded-xl bg-white shadow-sm border">🚪 Logout</button>
          </div>
        </div>
      );
    }

    function SideItem({ icon, label, active, onClick }){
      return (
        <button onClick={onClick} className={cls('w-full flex items-center gap-3 px-3 py-2 rounded-xl text-sm', active ? 'bg-slate-900 text-white' : 'hover:bg-slate-100 text-slate-700')}>
          <span className="text-base">{icon}</span>
          <span>{label}</span>
        </button>
      );
    }

    function QuickStats({ totalFollowers, todayEngagement }){
      return (
        <div className="grid grid-cols-1 lg:grid-cols-4 gap-4">
          <div className="card p-4">
            <div className="text-xs text-slate-500">Total Followers</div>
            <div className="text-2xl font-bold">{formatNumber(totalFollowers)}</div>
            <div className="text-xs text-slate-500 mt-1">Across all platforms</div>
          </div>
          <div className="card p-4">
            <div className="text-xs text-slate-500">Engagement Today</div>
            <div className="text-2xl font-bold">{formatNumber(todayEngagement)}</div>
            <div className="text-xs text-slate-500 mt-1">Likes • Comments • Shares</div>
          </div>
          <div className="card p-4 lg:col-span-2">
            <div className="flex items-center justify-between">
              <div className="text-sm font-semibold">7-day Impressions</div>
            </div>
            <div className="h-32 mt-2">
              <ResponsiveContainer width="100%" height="100%">
                <LineChart data={DEMO_SERIES} margin={{ top: 5, right: 12, left: -20, bottom: 0 }}>
                  <CartesianGrid strokeDasharray="3 3" />
                  <XAxis dataKey="name" />
                  <YAxis />
                  <Tooltip />
                  <Line type="monotone" dataKey="impressions" stroke="#2563eb" strokeWidth={2} dot={false} />
                </LineChart>
              </ResponsiveContainer>
            </div>
          </div>
        </div>
      );
    }

    function RecentPosts({ posts }){
      return (
        <div className="card p-4">
          <div className="flex items-center justify-between mb-2">
            <h3 className="font-semibold">Recent Posts</h3>
            <span className="text-xs text-slate-500">Last {Math.min(posts.length, 5)} shown</span>
          </div>
          <div className="divide-y">
            {posts.slice(0,5).map(p => (
              <div key={p.id} className="py-3 flex items-start gap-3">
                <div className="w-10 h-10 rounded-lg bg-slate-100 flex items-center justify-center shrink-0">📤</div>
                <div className="min-w-0">
                  <div className="text-sm font-medium truncate">{p.text || '(no text)'}</div>
                  <div className="text-xs text-slate-500 mt-1 flex flex-wrap gap-2">
                    {p.platforms.map(k => (<span key={k} className="px-2 py-0.5 rounded-full bg-slate-100">{k}</span>))}
                    <span>•</span>
                    <span>{new Date(p.createdAt).toLocaleString()}</span>
                  </div>
                </div>
              </div>
            ))}
            {posts.length===0 && (
              <div className="text-sm text-slate-500 py-6 text-center">No posts yet. Create your first one!</div>
            )}
          </div>
        </div>
      );
    }

    function CreatePost({ connected, onPost, onSchedule }){
      const [text, setText] = useState('');
      const [hashtags, setHashtags] = useState(['#DigitalRufiya', '#DRFMedia', '#DRFTube']);
      const [links, setLinks] = useState('');
      const [imageName, setImageName] = useState(null); // file names only (demo)
      const [videoName, setVideoName] = useState(null);
      const [schedule, setSchedule] = useState({ enabled:false, date:'', time:'' });
      const [targets, setTargets] = useState(()=> Object.fromEntries(Object.keys(connected).map(k=>[k, connected[k]])));

      useEffect(()=>{ setTargets(Object.fromEntries(Object.keys(connected).map(k=>[k, connected[k]]))); }, [connected]);

      const selectedPlatforms = useMemo(() => Object.entries(targets).filter(([,v])=>v).map(([k])=>k), [targets]);

      const clearForm = () => {
        setText(''); setHashtags(['#DigitalRufiya', '#DRFMedia', '#DRFTube']); setLinks(''); setImageName(null); setVideoName(null);
        setSchedule({ enabled:false, date:'', time:'' }); setTargets(Object.fromEntries(Object.keys(connected).map(k=>[k, connected[k]])));
      };

      const handlePostNow = () => {
        const payload = makePayload({ text, hashtags, links, imageName, videoName, platforms: selectedPlatforms });
        onPost(payload); clearForm();
      };

      const handleSchedule = () => {
        if(!schedule.date || !schedule.time) return;
        const when = new Date(`${schedule.date}T${schedule.time}`);
        const item = {
          id:`sch_${Date.now()}`,
          text, hashtags, links, hasImage: !!imageName, hasVideo: !!videoName,
          platforms: selectedPlatforms, runAt: when.toISOString(), createdAt: new Date().toISOString(),
        };
        onSchedule(item); clearForm();
      };

      return (
        <div className="grid grid-cols-1 lg:grid-cols-3 gap-4">
          <div className="card p-4 lg:col-span-2">
            <h3 className="font-semibold mb-3">Create Post</h3>
            <div className="space-y-4">
              <div>
                <label className="text-xs text-slate-500">Text</label>
                <textarea rows={5} className="w-full mt-1 rounded-xl border bg-white p-3 outline-none focus:ring-2 focus:ring-slate-300" placeholder="What’s your update today?" value={text} onChange={e=>setText(e.target.value)} />
              </div>

              <div>
                <label className="text-xs text-slate-500">Hashtags</label>
                <div className="flex flex-wrap gap-2 mt-1">
                  {hashtags.map((h,i)=> (
                    <span key={i} className="px-2 py-1 rounded-full bg-slate-100 text-sm flex items-center gap-1">{h}
                      <button className="text-slate-400 hover:text-slate-600" onClick={()=> setHashtags(hashtags.filter((_,idx)=> idx!==i))}>✖</button>
                    </span>
                  ))}
                </div>
                <div className="flex gap-2 mt-2">
                  <input className="flex-1 rounded-xl border bg-white px-3 py-2 outline-none focus:ring-2 focus:ring-slate-300" placeholder="#AddYourTag" onKeyDown={e=>{
                    if(e.key==='Enter'){
                      e.preventDefault(); const val = e.currentTarget.value.trim(); if(val) setHashtags(hs=>[...hs, val.startsWith('#')?val:'#'+val]); e.currentTarget.value='';
                    }
                  }} />
                  <button className="px-3 py-2 rounded-xl border bg-white hover:bg-slate-50" onClick={()=> setHashtags(hs=> Array.from(new Set([...hs, ...TAG_SUGGESTIONS])))}>Add Suggestions</button>
                </div>
              </div>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                <label className="flex items-center gap-3 px-3 py-2 rounded-xl border bg-white cursor-pointer hover:bg-slate-50">
                  🖼️ Image
                  <input type="file" accept="image/*" className="hidden" onChange={e=> setImageName(e.target.files?.[0]?.name || null)} />
                  {imageName && <span className="text-xs text-slate-500 truncate">{imageName}</span>}
                </label>
                <label className="flex items-center gap-3 px-3 py-2 rounded-xl border bg-white cursor-pointer hover:bg-slate-50">
                  🎬 Video
                  <input type="file" accept="video/*" className="hidden" onChange={e=> setVideoName(e.target.files?.[0]?.name || null)} />
                  {videoName && <span className="text-xs text-slate-500 truncate">{videoName}</span>}
                </label>
              </div>

              <div>
                <label className="text-xs text-slate-500">Links (optional)</label>
                <input value={links} onChange={e=>setLinks(e.target.value)} className="w-full mt-1 rounded-xl border bg-white px-3 py-2 outline-none focus:ring-2 focus:ring-slate-300" placeholder="https://drfchain.org, https://drfmedia.org/post/..." />
              </div>

              <div>
                <label className="text-xs text-slate-500">Platforms</label>
                <div className="grid grid-cols-2 md:grid-cols-3 gap-2 mt-2">
                  {PLATFORMS.map(p => (
                    <button key={p.key} onClick={()=> setTargets(s=> ({...s, [p.key]: !s[p.key]}))} className={cls('px-3 py-2 rounded-xl border text-left', targets[p.key] ? 'bg-slate-900 text-white' : 'bg-white hover:bg-slate-50')}>
                      <div className="text-sm font-medium">{p.label}</div>
                      <div className="text-[10px] opacity-70">{p.hint}</div>
                    </button>
                  ))}
                </div>
              </div>

              <div className="flex flex-col md:flex-row md:items-center gap-3 md:justify-between">
                <div className="flex items-center gap-2">
                  <label className="inline-flex items-center gap-2 text-sm">
                    <input type="checkbox" checked={schedule.enabled} onChange={e=> setSchedule(s=> ({...s, enabled: e.target.checked}))} />
                    Schedule later
                  </label>
                  {schedule.enabled && (
                    <div className="flex items-center gap-2">
                      <input type="date" value={schedule.date} onChange={e=> setSchedule(s=> ({...s, date: e.target.value}))} className="rounded-xl border px-2 py-1" />
                      <input type="time" value={schedule.time} onChange={e=> setSchedule(s=> ({...s, time: e.target.value}))} className="rounded-xl border px-2 py-1" />
                    </div>
                  )}
                </div>
                <div className="flex items-center gap-2">
                  {!schedule.enabled && (
                    <button onClick={handlePostNow} className="px-4 py-2 rounded-2xl bg-slate-900 text-white flex items-center gap-2">📤 Post Now</button>
                  )}
                  {schedule.enabled && (
                    <button onClick={handleSchedule} className="px-4 py-2 rounded-2xl bg-slate-900 text-white flex items-center gap-2">⏰ Schedule</button>
                  )}
                  <button onClick={clearForm} className="px-4 py-2 rounded-2xl bg-white border">Reset</button>
                </div>
              </div>
            </div>
          </div>

          {/* Preview */}
          <div className="card p-4">
            <h3 className="font-semibold mb-3">Live Preview</h3>
            <div className="rounded-xl border bg-slate-50 p-3 space-y-2">
              <div className="text-sm whitespace-pre-wrap">{text || '(Your post text will appear here)'}</div>
              <div className="flex flex-wrap gap-2 text-sm">
                {hashtags.map((h,i)=> (<span key={i} className="px-2 py-1 rounded-full bg-white border">{h}</span>))}
              </div>
              {links && (<div className="text-xs text-slate-600 break-all">Links: {links}</div>)}
              <div className="text-xs text-slate-500">Platforms: {selectedPlatforms.length ? selectedPlatforms.join(', ') : '(none selected)'}</div>
            </div>
          </div>
        </div>
      );
    }

    function ScheduleManager({ items, onDelete }){
      return (
        <div className="card p-4">
          <div className="flex items-center justify-between mb-3">
            <h3 className="font-semibold">Scheduled Posts</h3>
            <span className="text-xs text-slate-500">{items.length} total</span>
          </div>
          <div className="divide-y">
            {items.map(it => (
              <div key={it.id} className="py-3 flex items-start gap-3">
                <div className="w-10 h-10 rounded-lg bg-slate-100 flex items-center justify-center shrink-0">⏰</div>
                <div className="min-w-0 flex-1">
                  <div className="text-sm font-medium truncate">{it.text || '(no text)'}</div>
                  <div className="text-xs text-slate-500 mt-1 flex flex-wrap gap-2">
                    {it.platforms.map(k => (<span key={k} className="px-2 py-0.5 rounded-full bg-slate-100">{k}</span>))}
                    <span>•</span>
                    <span>Runs: {new Date(it.runAt).toLocaleString()}</span>
                  </div>
                </div>
                <div className="flex items-center gap-2">
                  <button onClick={()=> onDelete(it.id)} className="px-2 py-1 rounded-lg bg-white border text-slate-600 hover:bg-slate-50">🗑️</button>
                </div>
              </div>
            ))}
            {items.length===0 && (
              <div className="text-sm text-slate-500 py-6 text-center">No scheduled posts. Create one from "Create Post".</div>
            )}
          </div>
        </div>
      );
    }

    function AnalyticsSection(){
      return (
        <div className="grid grid-cols-1 xl:grid-cols-3 gap-4">
          <div className="card p-4 xl:col-span-2">
            <div className="flex items-center justify-between mb-2"><h3 className="font-semibold">Impressions vs Engagement (7 days)</h3></div>
            <div className="h-64">
              <ResponsiveContainer width="100%" height="100%">
                <BarChart data={DEMO_SERIES} margin={{ top: 5, right: 12, left: -20, bottom: 0 }}>
                  <CartesianGrid strokeDasharray="3 3" />
                  <XAxis dataKey="name" />
                  <YAxis />
                  <Tooltip />
                  <Bar dataKey="impressions" fill="#3b82f6" />
                  <Bar dataKey="engagement" fill="#10b981" />
                </BarChart>
              </ResponsiveContainer>
            </div>
          </div>
          <div className="card p-4">
            <h3 className="font-semibold mb-2">Best Platform (share %)</h3>
            <div className="h-64">
              <ResponsiveContainer width="100%" height="100%">
                <PieChart>
                  <Pie data={PIE} dataKey="value" nameKey="name" outerRadius={100} label>
                    {PIE.map((e, i)=> (<Cell key={i} />))}
                  </Pie>
                  <Tooltip />
                </PieChart>
              </ResponsiveContainer>
            </div>
          </div>
          <div className="card p-4 xl:col-span-3">
            <h3 className="font-semibold mb-2">Posts Performance (demo)</h3>
            <div className="h-64">
              <ResponsiveContainer width="100%" height="100%">
                <LineChart data={DEMO_SERIES} margin={{ top: 5, right: 12, left: -20, bottom: 0 }}>
                  <CartesianGrid strokeDasharray="3 3" />
                  <XAxis dataKey="name" />
                  <YAxis />
                  <Tooltip />
                  <Line type="monotone" dataKey="engagement" stroke="#8b5cf6" strokeWidth={2} />
                </LineChart>
              </ResponsiveContainer>
            </div>
          </div>
        </div>
      );
    }

    function SettingsSection({ connected, setConnected }){
      return (
        <div className="card p-4">
          <h3 className="font-semibold mb-3">Settings & Connections</h3>
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
            {PLATFORMS.map(p => (
              <div key={p.key} className="p-3 rounded-xl border bg-white">
                <div className="flex items-center justify-between">
                  <div>
                    <div className="text-sm font-semibold">{p.label}</div>
                    <div className="text-[11px] text-slate-500">{p.hint}</div>
                  </div>
                  {connected[p.key] ? (
                    <span className="text-green-600 text-xs">✔ Connected</span>
                  ) : (
                    <span className="text-slate-400 text-xs">○ Not Connected</span>
                  )}
                </div>
                <div className="mt-3 flex items-center gap-2">
                  {!connected[p.key] ? (
                    <button onClick={()=> setConnected(s=> ({...s, [p.key]: true}))} className="px-3 py-2 rounded-xl bg-slate-900 text-white text-sm">Connect</button>
                  ) : (
                    <button onClick={()=> setConnected(s=> ({...s, [p.key]: false}))} className="px-3 py-2 rounded-xl bg-white border text-sm">Disconnect</button>
                  )}
                </div>
              </div>
            ))}
          </div>
        </div>
      );
    }

    function Toast({ toast, onClose }){
      useEffect(()=>{ if(!toast) return; const t=setTimeout(onClose, 2200); return ()=> clearTimeout(t); }, [toast]);
      return (
        <AnimatePresence>
          {toast && (
            <motion.div initial={{opacity:0,y:12}} animate={{opacity:1,y:0}} exit={{opacity:0,y:12}} className="fixed bottom-4 left-1/2 -translate-x-1/2 bg-slate-900 text-white px-4 py-2 rounded-2xl shadow-lg">
              {toast}
            </motion.div>
          )}
        </AnimatePresence>
      );
    }

    function makePayload({ text, hashtags, links, imageName, videoName, platforms }){
      return { id: `post_${Date.now()}`, text, hashtags, links, image: imageName, video: videoName, platforms, createdAt: new Date().toISOString() };
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
