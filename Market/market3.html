<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Simple Pinata Upload</title>
<style>
  body {
    font-family: Arial, sans-serif;
    max-width: 400px;
    margin: 2rem auto;
    padding: 1rem;
    background: #f8f8f8;
  }
  label {
    display: block;
    margin-top: 1rem;
  }
  input, button {
    width: 100%;
    padding: 0.5rem;
    margin-top: 0.5rem;
  }
  #progressBar {
    width: 100%;
    background: #ddd;
    margin-top: 1rem;
  }
  #progressBar div {
    height: 15px;
    width: 0;
    background: #28a745;
  }
  #status {
    margin-top: 1rem;
    font-weight: bold;
  }
</style>
</head>
<body>

<h2>Upload your product media to Pinata</h2>

<form id="uploadForm">
  <label for="file">Select image or video file:</label>
  <input type="file" id="file" accept="image/*,video/*" required />

  <label for="title">Product Title:</label>
  <input type="text" id="title" placeholder="Title" required />

  <label for="price">Price (MVR):</label>
  <input type="number" id="price" placeholder="Price" min="0" step="0.01" required />

  <button type="submit">Upload to Pinata</button>
</form>

<div id="progressBar"><div></div></div>
<div id="status"></div>

<script>
  const pinataJWT = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySW5mb3JtYXRpb24iOnsiaWQiOiI0MjA3ZmYxYS05MDU2LTRkZTktOGE2Yi1lM2JiZTA1YmY0YmEiLCJlbWFpbCI6ImRpZ2l0YWxydWZpeWF1bml2ZXJzaXR5QGdtYWlsLmNvbSIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJwaW5fcG9saWN5Ijp7InJlZ2lvbnMiOlt7ImRlc2lyZWRSZXBsaWNhdGlvbkNvdW50IjoxLCJpZCI6IkZSQTEifSx7ImRlc2lyZWRSZXBsaWNhdGlvbkNvdW50IjoxLCJpZCI6Ik5ZQzEifV0sInZlcnNpb24iOjF9LCJtZmFfZW5hYmxlZCI6ZmFsc2UsInN0YXR1cyI6IkFDVElWRSJ9LCJhdXRoZW50aWNhdGlvblR5cGUiOiJzY29wZWRLZXkiLCJzY29wZWRLZXlLZXkiOiJhNjEzMWU0MTdmNGUzOTljZDgwNiIsInNjb3BlZEtleVNlY3JldCI6ImQ4MDgwZjMzN2RjNDdhNjY1YWRlNTU3NWU2MDA0NmU4NDU0YjZkNmQ4MDcxYTY5YzBiODM2ODhiOTE2Mzg4OWYiLCJleHAiOjE3ODYyNzM3MTd9.AuOo1PiDfQEK_TodAsAcHBYiH4MkA4xwIYAtcX1Le6s";

  const form = document.getElementById("uploadForm");
  const fileInput = document.getElementById("file");
  const titleInput = document.getElementById("title");
  const priceInput = document.getElementById("price");
  const progressBar = document.querySelector("#progressBar div");
  const status = document.getElementById("status");

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    if (fileInput.files.length === 0) {
      alert("Please select a file");
      return;
    }

    const file = fileInput.files[0];
    const title = titleInput.value.trim();
    const price = priceInput.value.trim();

    status.textContent = "";
    progressBar.style.width = "0%";

    const formData = new FormData();
    formData.append("file", file);

    try {
      const xhr = new XMLHttpRequest();
      xhr.open("POST", "https://api.pinata.cloud/pinning/pinFileToIPFS");
      xhr.setRequestHeader("Authorization", "Bearer " + pinataJWT);

      xhr.upload.onprogress = (event) => {
        if (event.lengthComputable) {
          const percent = (event.loaded / event.total) * 100;
          progressBar.style.width = percent + "%";
        }
      };

      xhr.onload = () => {
        if (xhr.status === 200) {
          const response = JSON.parse(xhr.responseText);
          status.style.color = "green";
          status.textContent = `Uploaded! IPFS Hash: ${response.IpfsHash}
Product Title: ${title}
Price: MVR ${price}`;
        } else {
          status.style.color = "red";
          status.textContent = `Upload failed: ${xhr.status} ${xhr.statusText}`;
        }
      };

      xhr.onerror = () => {
        status.style.color = "red";
        status.textContent = "Network error during upload";
      };

      xhr.send(formData);
    } catch (error) {
      status.style.color = "red";
      status.textContent = "Error: " + error.message;
    }
  });
</script>

</body>
</html>
