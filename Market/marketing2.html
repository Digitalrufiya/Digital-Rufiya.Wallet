<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>DRF Marketing Post</title>

<meta property="og:title" content="DRF Marketing Post" />
<meta property="og:description" content="Check out this post!" />
<meta property="og:image" content="" />
<meta property="og:url" content="" />
<meta property="og:type" content="website" />

<style>
  body { font-family: Arial, sans-serif; margin:0; padding:18px; background:#f3f4f6; color:#111; }
  #post-container { max-width:800px; margin:auto; background:#fff; padding:16px; border-radius:10px; box-shadow:0 6px 18px rgba(0,0,0,0.06); }
  h1 { font-size:22px; margin-bottom:8px; }
  p { font-size:16px; margin-bottom:12px; }
  img, video { max-width:100%; border-radius:6px; margin-bottom:12px; }
  .buttons { display:flex; gap:8px; flex-wrap:wrap; margin-top:12px; }
  .share-btn { flex:1; text-align:center; padding:6px 0; background:#10b981; color:#fff; border-radius:6px; cursor:pointer; text-decoration:none; font-size:14px; }
</style>
</head>
<body>

<section id="post-container">
  <h1 id="post-title">Loading...</h1>
  <p id="post-description"></p>
  <div id="post-media"></div>
  <div class="buttons">
    <a id="fbShare" class="share-btn" target="_blank">Facebook</a>
    <a id="twShare" class="share-btn" target="_blank">Twitter</a>
    <a id="liShare" class="share-btn" target="_blank">LinkedIn</a>
    <div class="share-btn" id="copyLink">Copy Link</div>
  </div>
</section>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDBxNIIuYonkgF9m8QYdUFDOXIXAM6FYqA",
  authDomain: "drfmarket-place.firebaseapp.com",
  projectId: "drfmarket-place",
  storageBucket: "drfmarket-place.firebasestorage.app",
  messagingSenderId: "752616443115",
  appId: "1:752616443115:web:73b71924daf66ae9c882ae",
  measurementId: "G-MV9JQZHLLY"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const params = new URLSearchParams(window.location.search);
const postId = params.get("id");
const titleEl = document.getElementById("post-title");
const descEl = document.getElementById("post-description");
const mediaEl = document.getElementById("post-media");

const fbShare = document.getElementById("fbShare");
const twShare = document.getElementById("twShare");
const liShare = document.getElementById("liShare");
const copyLink = document.getElementById("copyLink");

if (!postId) {
  titleEl.textContent = "No post ID provided!";
} else {
  async function loadPost() {
    try {
      const docRef = doc(db, "marketingPosts", postId);
      const docSnap = await getDoc(docRef);
      if (docSnap.exists()) {
        const data = docSnap.data();
        titleEl.textContent = data.title;
        descEl.textContent = data.description;

        if (data.mediaType === "video") {
          const video = document.createElement("video");
          video.src = `https://gateway.pinata.cloud/ipfs/${data.ipfsHash}`;
          video.controls = true;
          mediaEl.appendChild(video);
        } else {
          const img = document.createElement("img");
          img.src = `https://gateway.pinata.cloud/ipfs/${data.ipfsHash}`;
          mediaEl.appendChild(img);
        }

        const postLink = encodeURIComponent(window.location.href);
        const text = encodeURIComponent(`${data.title} - ${data.description}`);
        fbShare.href = `https://www.facebook.com/sharer/sharer.php?u=${postLink}`;
        twShare.href = `https://twitter.com/intent/tweet?url=${postLink}&text=${text}`;
        liShare.href = `https://www.linkedin.com/shareArticle?mini=true&url=${postLink}&title=${text}`;
        copyLink.onclick = () => { navigator.clipboard.writeText(window.location.href).then(()=>alert("Link copied!")); }

        // Update OG meta tags
        document.querySelector('meta[property="og:title"]').content = data.title;
        document.querySelector('meta[property="og:description"]').content = data.description;
        document.querySelector('meta[property="og:image"]').content = `https://gateway.pinata.cloud/ipfs/${data.ipfsHash}`;
        document.querySelector('meta[property="og:url"]').content = window.location.href;

      } else {
        titleEl.textContent = "Post not found!";
      }
    } catch (err) {
      console.error(err);
      titleEl.textContent = "Error loading post";
    }
  }

  loadPost();
}
</script>

</body>
</html>
