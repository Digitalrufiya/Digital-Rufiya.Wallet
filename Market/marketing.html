<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DRF Marketing Tool</title>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center">

  <div class="w-full max-w-2xl p-4">
    <h1 class="text-2xl font-bold text-center mb-4">ðŸ“¢ DRF Marketing Tool</h1>

    <!-- Upload Form -->
    <div class="bg-white shadow p-4 rounded mb-6">
      <h2 class="text-lg font-semibold mb-2">Create Campaign</h2>
      <input id="title" type="text" placeholder="Campaign Title" class="w-full border p-2 rounded mb-2">
      <textarea id="description" placeholder="Campaign Description" class="w-full border p-2 rounded mb-2"></textarea>
      <input id="image" type="file" class="mb-2">
      <button onclick="submitPost()" class="bg-blue-600 text-white px-4 py-2 rounded">Publish</button>
    </div>

    <!-- Feed -->
    <div id="feed" class="space-y-4"></div>
  </div>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

    // âœ… Corrected Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyDBxNIIuYonkgF9m8QYdUFDOXIXAM6FYqA",
      authDomain: "drfmarket-place.firebaseapp.com",
      projectId: "drfmarket-place",
      storageBucket: "drfmarket-place.appspot.com",  // FIXED
      messagingSenderId: "752616443115",
      appId: "1:752616443115:web:73b71924daf66ae9c882ae",
      measurementId: "G-MV9JQZHLLY"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const PINATA_JWT = "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...."; 

    async function submitPost() {
      const title = document.getElementById("title").value;
      const description = document.getElementById("description").value;
      const fileInput = document.getElementById("image");

      let ipfsUrl = "";

      if (fileInput.files.length > 0) {
        const file = fileInput.files[0];
        const formData = new FormData();
        formData.append("file", file);

        const res = await fetch("https://api.pinata.cloud/pinning/pinFileToIPFS", {
          method: "POST",
          headers: { Authorization: PINATA_JWT },
          body: formData
        });

        const data = await res.json();
        ipfsUrl = `https://gateway.pinata.cloud/ipfs/${data.IpfsHash}`;
      }

      await addDoc(collection(db, "campaigns"), {
        title,
        description,
        image: ipfsUrl,
        timestamp: new Date().toISOString()
      });

      alert("Campaign Published âœ…");
      loadPosts();
    }

    async function loadPosts() {
      const feed = document.getElementById("feed");
      feed.innerHTML = "";

      const querySnapshot = await getDocs(collection(db, "campaigns"));
      querySnapshot.forEach((doc) => {
        const post = doc.data();
        const text = encodeURIComponent(`${post.title} - ${post.description}`);
        const shareUrl = encodeURIComponent(post.image || window.location.href);

        feed.innerHTML += `
          <div class="bg-white shadow p-4 rounded">
            <h3 class="text-xl font-semibold">${post.title}</h3>
            <p class="text-gray-700">${post.description}</p>
            ${post.image ? `<img src="${post.image}" class="mt-2 rounded">` : ""}
            <div class="flex space-x-4 mt-2">
              <a href="https://twitter.com/intent/tweet?text=${text}&url=${shareUrl}" target="_blank" class="text-blue-400">Twitter</a>
              <a href="https://www.facebook.com/sharer/sharer.php?u=${shareUrl}" target="_blank" class="text-blue-600">Facebook</a>
              <a href="https://api.whatsapp.com/send?text=${text}%20${shareUrl}" target="_blank" class="text-green-500">WhatsApp</a>
            </div>
          </div>
        `;
      });
    }

    loadPosts();
    window.submitPost = submitPost;
  </script>
</body>
</html>
