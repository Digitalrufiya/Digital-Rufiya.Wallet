<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DRF Marketing Tool</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center">

  <div class="bg-white shadow-xl rounded-2xl p-6 w-full max-w-md">
    <h1 class="text-2xl font-bold mb-4 text-center">üì¢ DRF Marketing Tool</h1>

    <input id="postTitle" type="text" placeholder="Enter title"
      class="w-full border rounded p-2 mb-3" />
    <textarea id="postDesc" placeholder="Enter description"
      class="w-full border rounded p-2 mb-3"></textarea>
    <input id="postImage" type="file" accept="image/*"
      class="w-full mb-3" />

    <button onclick="submitPost()" class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700">
      Upload & Share
    </button>

    <div id="output" class="mt-4 text-sm"></div>
  </div>

  <!-- Firebase compat SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-storage-compat.js"></script>

  <script>
    // ‚úÖ Firebase config (fixed storageBucket)
    const firebaseConfig = {
      apiKey: "AIzaSyDBxNIIuYonkgF9m8QYdUFDOXIXAM6FYqA",
      authDomain: "drfmarket-place.firebaseapp.com",
      projectId: "drfmarket-place",
      storageBucket: "drfmarket-place.appspot.com", // FIXED ‚úÖ
      messagingSenderId: "752616443115",
      appId: "1:752616443115:web:73b71924daf66ae9c882ae",
      measurementId: "G-MV9JQZHLLY"
    };
    firebase.initializeApp(firebaseConfig);
    const storage = firebase.storage();

    // ‚úÖ Pinata JWT (raw, no "Bearer " prefix here!)
    const PINATA_JWT = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...."; 

    async function submitPost() {
      const title = document.getElementById("postTitle").value;
      const desc = document.getElementById("postDesc").value;
      const file = document.getElementById("postImage").files[0];
      const output = document.getElementById("output");

      if (!file) {
        alert("Please choose an image.");
        return;
      }

      output.innerHTML = "‚è≥ Uploading...";

      try {
        // ‚úÖ Upload to Pinata (IPFS)
        const formData = new FormData();
        formData.append("file", file);

        const res = await fetch("https://api.pinata.cloud/pinning/pinFileToIPFS", {
          method: "POST",
          headers: {
            Authorization: `Bearer ${PINATA_JWT}`, // FIXED ‚úÖ
          },
          body: formData,
        });

        if (!res.ok) throw new Error("Pinata upload failed: " + res.statusText);
        const data = await res.json();
        const ipfsUrl = `https://gateway.pinata.cloud/ipfs/${data.IpfsHash}`;

        // ‚úÖ Upload to Firebase
        const storageRef = storage.ref().child("posts/" + file.name);
        await storageRef.put(file);
        const firebaseUrl = await storageRef.getDownloadURL();

        // ‚úÖ Show success + share links
        output.innerHTML = `
          ‚úÖ Uploaded Successfully!<br>
          <b>Title:</b> ${title}<br>
          <b>Description:</b> ${desc}<br>
          <b>IPFS:</b> <a href="${ipfsUrl}" target="_blank">${ipfsUrl}</a><br>
          <b>Firebase:</b> <a href="${firebaseUrl}" target="_blank">${firebaseUrl}</a><br><br>

          <div class="flex gap-2">
            <a href="https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(ipfsUrl)}" target="_blank"
              class="bg-blue-500 text-white px-3 py-1 rounded">Facebook</a>
            <a href="https://twitter.com/intent/tweet?url=${encodeURIComponent(ipfsUrl)}&text=${encodeURIComponent(title)}"
              target="_blank" class="bg-sky-400 text-white px-3 py-1 rounded">Twitter</a>
            <a href="https://www.linkedin.com/shareArticle?mini=true&url=${encodeURIComponent(ipfsUrl)}&title=${encodeURIComponent(title)}&summary=${encodeURIComponent(desc)}"
              target="_blank" class="bg-blue-700 text-white px-3 py-1 rounded">LinkedIn</a>
          </div>
        `;
      } catch (err) {
        console.error(err);
        output.innerHTML = "‚ùå Upload failed. Check console.";
      }
    }
  </script>
</body>
</html>
