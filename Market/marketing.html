<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DRF Marketing Tool</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js"></script>
</head>
<body class="bg-gray-100 font-sans">

  <div class="max-w-2xl mx-auto mt-10 bg-white shadow-lg rounded-2xl p-6">
    <h1 class="text-2xl font-bold text-center mb-6 text-indigo-600">ğŸ“¢ DRF Marketing Platform</h1>

    <!-- Post Form -->
    <div class="mb-6">
      <input id="title" type="text" placeholder="Enter Title" 
        class="w-full mb-3 p-3 border rounded-lg focus:ring focus:ring-indigo-300" />
      <textarea id="description" placeholder="Enter Description"
        class="w-full mb-3 p-3 border rounded-lg focus:ring focus:ring-indigo-300"></textarea>
      <button onclick="submitPost()" 
        class="w-full bg-indigo-600 text-white p-3 rounded-lg hover:bg-indigo-700">Upload Post</button>
    </div>

    <!-- Posts List -->
    <h2 class="text-lg font-semibold mb-3">ğŸ“Œ Uploaded Posts</h2>
    <div id="posts" class="space-y-4"></div>
  </div>

<script type="module">
  // ----------------- Firebase Setup -----------------
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDBxNIIuYonkgF9m8QYdUFDOXIXAM6FYqA",
    authDomain: "drfmarket-place.firebaseapp.com",
    projectId: "drfmarket-place",
    storageBucket: "drfmarket-place.firebasestorage.app",
    messagingSenderId: "752616443115",
    appId: "1:752616443115:web:73b71924daf66ae9c882ae",
    measurementId: "G-MV9JQZHLLY"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // ----------------- Pinata Config -----------------
  const PINATA_JWT = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySW5mb3JtYXRpb24iOnsiaWQiOiI0MjA3ZmYxYS05MDU2LTRkZTktOGE2Yi1lM2JiZTA1YmY0YmEiLCJlbWFpbCI6ImRpZ2l0YWxydWZpeWF1bml2ZXJzaXR5QGdtYWlsLmNvbSIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJwaW5fcG9saWN5Ijp7InJlZ2lvbnMiOlt7ImRlc2lyZWRSZXBsaWNhdGlvbkNvdW50IjoxLCJpZCI6IkZSQTEifSx7ImRlc2lyZWRSZXBsaWNhdGlvbkNvdW50IjoxLCJpZCI6Ik5ZQzEifV0sInZlcnNpb24iOjF9LCJtZmFfZW5hYmxlZCI6ZmFsc2UsInN0YXR1cyI6IkFDVElWRSJ9LCJhdXRoZW50aWNhdGlvblR5cGUiOiJzY29wZWRLZXkiLCJzY29wZWRLZXlLZXkiOiIyYjA3YjEyOWJkYTA0YTY2YmE0YSIsInNjb3BlZEtleVNlY3JldCI6IjYxZDdhMGVhYzVmNjAyNzhhNjQyODNlMjdmMTM2YjkxMjQ3YjM4NDg5MjA4YTUzNGYxNWFlMTE2Njc3ZGNkZGQiLCJleHAiOjE3ODYyNzUyNDJ9.BFUeEjlCR0jtpr1vylWYd5VkKVtDkNDhEuC2-3IFW1w";

  // ----------------- Functions -----------------
  async function submitPost() {
    const title = document.getElementById("title").value.trim();
    const description = document.getElementById("description").value.trim();

    if (!title || !description) {
      alert("Please enter both title and description!");
      return;
    }

    try {
      // Upload to Pinata as JSON
      const body = {
        pinataContent: { title, description, timestamp: new Date().toISOString() },
        pinataMetadata: { name: "drf_post" }
      };

      const res = await fetch("https://api.pinata.cloud/pinning/pinJSONToIPFS", {
        method: "POST",
        headers: {
          "Authorization": `Bearer ${PINATA_JWT}`,
          "Content-Type": "application/json"
        },
        body: JSON.stringify(body)
      });

      const data = await res.json();
      const ipfsHash = data.IpfsHash;

      // Save metadata in Firestore
      await addDoc(collection(db, "posts"), { title, description, ipfsHash, createdAt: new Date() });

      alert("âœ… Post uploaded successfully!");
      loadPosts();
    } catch (e) {
      console.error(e);
      alert("âŒ Error uploading post!");
    }
  }

  async function loadPosts() {
    const postsDiv = document.getElementById("posts");
    postsDiv.innerHTML = "";

    const querySnapshot = await getDocs(collection(db, "posts"));
    querySnapshot.forEach((doc) => {
      const post = doc.data();
      const ipfsLink = `https://gateway.pinata.cloud/ipfs/${post.ipfsHash}`;
      postsDiv.innerHTML += `
        <div class="p-4 border rounded-lg shadow bg-gray-50">
          <h3 class="font-bold text-indigo-700">${post.title}</h3>
          <p class="text-gray-600">${post.description}</p>
          <a href="${ipfsLink}" target="_blank" class="text-sm text-blue-500">ğŸŒ View on IPFS</a>

          <!-- Share Buttons -->
          <div class="mt-3 flex gap-2">
            <a href="https://www.facebook.com/sharer/sharer.php?u=${ipfsLink}" target="_blank" class="px-3 py-1 bg-blue-600 text-white text-sm rounded">Facebook</a>
            <a href="https://twitter.com/intent/tweet?url=${ipfsLink}&text=${encodeURIComponent(post.title)}" target="_blank" class="px-3 py-1 bg-sky-500 text-white text-sm rounded">Twitter</a>
            <a href="https://wa.me/?text=${encodeURIComponent(post.title + ' ' + ipfsLink)}" target="_blank" class="px-3 py-1 bg-green-500 text-white text-sm rounded">WhatsApp</a>
            <a href="https://www.linkedin.com/shareArticle?mini=true&url=${ipfsLink}&title=${encodeURIComponent(post.title)}" target="_blank" class="px-3 py-1 bg-blue-700 text-white text-sm rounded">LinkedIn</a>
          </div>
        </div>
      `;
    });
  }

  // Load posts on page start
  loadPosts();
</script>

</body>
</html>
